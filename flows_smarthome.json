[{"id":"1c11632f.f206fd","type":"tab","label":"Smarthus","disabled":false,"info":""},{"id":"85114e25.ae2ad","type":"tab","label":"1 ETG: Bevegelse","disabled":false,"info":""},{"id":"8b99f8fe.7b27b8","type":"tab","label":"Smarthome_MODE","disabled":false,"info":""},{"id":"9318493b.8ed8b8","type":"tab","label":"KJELLER: Bevegelse","disabled":false,"info":""},{"id":"1b14ec1b.20ab54","type":"tab","label":"Happy","disabled":false,"info":""},{"id":"bc3b2c68.b35f6","type":"tab","label":"Garbage Collector","disabled":false,"info":""},{"id":"605ae98f.8a9998","type":"tab","label":"Bedroom","disabled":false,"info":""},{"id":"f487aa99.386108","type":"tab","label":"Data","disabled":false,"info":""},{"id":"edb6b263.c07ca","type":"subflow","name":"SUB:Smarhome_MODE","info":"","category":"","in":[{"x":89.99999237060547,"y":103.33333396911621,"wires":[]}],"out":[{"x":1598.3332195281982,"y":106.66666221618652,"wires":[{"id":"b1aee17e.bf184","port":0},{"id":"17936d13.2bd563","port":0}]}]},{"id":"fbdfe0f1.47d8","type":"subflow","name":"Iterate","in":[{"x":220,"y":219,"wires":[{"id":"f75f85a7.382cd8"}]}],"out":[{"x":454,"y":174,"wires":[{"id":"f75f85a7.382cd8","port":0}]},{"x":455,"y":259,"wires":[{"id":"f75f85a7.382cd8","port":1}]}]},{"id":"f6aee802.f74bc8","type":"mqtt-broker","z":"","name":"Homeseer","broker":"192.168.1.103","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"homeseer","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"dccbff74.2769","type":"node-hue-bridge","z":"","name":"Hue Bridge","address":"192.168.1.53","key":"VBGb8l3baRWQyLpSQK2-GAB6H0UsRj37n3e51l3O","interval":"10000"},{"id":"c40d1711.7fd448","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"8d9ae12b.2a6f5","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"8a264f87.d9145","type":"ui_group","z":"","name":"Floorplan","tab":"8d9ae12b.2a6f5","disp":true,"width":"18","collapse":false},{"id":"530528aa.2006c8","type":"pushbullet-config","z":"","name":"Øivind"},{"id":"d1934670.897a88","type":"googlehome-config-node","z":"","ipaddress":"192.168.1.89","name":"Kjeller: Norsk","language":"no"},{"id":"a967d384.f5115","type":"googlehome-config-node","z":"","ipaddress":"192.168.1.89","name":"Kjeller: RU","language":"ru"},{"id":"35cb409b.4a073","type":"googlehome-config-node","z":"","ipaddress":"192.168.1.89","name":"Kjeller: ENG","language":"en"},{"id":"5ee6b185.35f2d","type":"googlehome-config-node","z":"","ipaddress":"192.168.1.44","name":"Stue: RU","language":"ru"},{"id":"354eb0bd.91999","type":"googlehome-config-node","z":"","ipaddress":"192.168.1.44","name":"Stue: ENG","language":"en"},{"id":"429b8253.24d1dc","type":"googlehome-config-node","z":"","ipaddress":"192.168.1.44","name":"Stue: NO","language":"no"},{"id":"ca3eef.3da5b11","type":"ui_group","z":"","name":"Kjeller","tab":"8d9ae12b.2a6f5","disp":true,"width":"6","collapse":false},{"id":"56a8be2a.9b9eb","type":"ui_group","z":"","name":"House","tab":"8d9ae12b.2a6f5","disp":true,"width":"6","collapse":false},{"id":"efd0ae.1a06bf5","type":"ui_group","z":"","name":"1 Etg","tab":"8d9ae12b.2a6f5","disp":true,"width":"6","collapse":false},{"id":"12895ae7.9c6bf5","type":"deconz-server","z":"","name":"Zigbee","ip":"192.168.1.103","port":"80","apikey":"864A633FD5","ws_port":"8088","secure":false,"polling":"15"},{"id":"3fb4f73e.f3cd38","type":"futurehome-login","z":"","displayName":"Øivind","site_name":"Hegglunds","base_uri":"futurehome.no/","username":"oivheg@gmail.com"},{"id":"83ed609b.13959","type":"homekit-bridge","z":"","bridgeName":"Hegglunds","pinCode":"111-11-111","port":"","allowInsecureRequest":false,"manufacturer":"Default Manufacturer","model":"Default Model","serialNo":"Default Serial Number","customMdnsConfig":false,"mdnsMulticast":true,"mdnsInterface":"","mdnsPort":"","mdnsIp":"","mdnsTtl":"","mdnsLoopback":true,"mdnsReuseAddr":true,"allowMessagePassthrough":true},{"id":"1f05e387.5d527c","type":"ui_tab","z":"","name":"List","icon":"dashboard"},{"id":"54f6a8ea.957eb8","type":"nora-config","z":"","name":"hegglunds","group":"","notify":false},{"id":"99977a8c.c02588","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"movement","name":"","usetls":false,"tls":""},{"id":"583fffe9.e7d8f","type":"ui_group","z":"","name":"Bevegelse","tab":"1f05e387.5d527c","disp":true,"width":24,"collapse":false},{"id":"dc3b6369.69156","type":"switch","z":"1c11632f.f206fd","name":"FH:What Light","property":"payload.name","propertyType":"msg","rules":[{"t":"eq","v":"Stue","vt":"str"},{"t":"eq","v":"Kjøkken","vt":"str"},{"t":"eq","v":"Kjeller Gang","vt":"str"},{"t":"eq","v":"Vaskerom: Lys","vt":"str"},{"t":"eq","v":"Closet","vt":"str"},{"t":"eq","v":"Karina ","vt":"str"},{"t":"eq","v":"Gangen","vt":"str"},{"t":"eq","v":"Kontor: Lys","vt":"str"}],"checkall":"false","repair":false,"outputs":8,"x":1580,"y":720,"wires":[["580e22c4.a8ebac"],["b3b75b9a.20c1a8"],["87ef4cd9.24919"],["b7aa8b08.2d6208"],["7ebcbc9e.7409d4"],["d6c2e23f.d29f8"],["ca0455.e1f13ba8"],["fc79aea8.12ce5"]]},{"id":"c93d9ccb.30d74","type":"function","z":"1c11632f.f206fd","name":"On\\Off","func":"msg.payload;\nmsg.payload.on =  msg.payload.power === \"on\" ? true : false \nreturn msg;","outputs":1,"noerr":0,"x":1390,"y":620,"wires":[["dc3b6369.69156","2552d668.c01cea","8f119d5d.e9645","26ee5240.91657e"]]},{"id":"b60e383f.f82dc8","type":"function","z":"1c11632f.f206fd","name":"Set Karinas Office","func":"let msg2 = {payload: {devices: {id: \"karina\",name:\"Karinas office\", power : msg.payload.on === true ? \"on\" : \"off\"}}}\nreturn msg2;","outputs":1,"noerr":0,"x":450,"y":300,"wires":[["66d9f1c.785941"]]},{"id":"2552d668.c01cea","type":"switch","z":"1c11632f.f206fd","name":"Hue Lights","property":"payload.name","propertyType":"msg","rules":[{"t":"eq","v":"Karinas office","vt":"str"}],"checkall":"false","repair":false,"outputs":1,"x":1590,"y":900,"wires":[["d937e7f8.315d88"]]},{"id":"10016b07.ab9885","type":"comment","z":"8b99f8fe.7b27b8","name":"Presence","info":"","x":320,"y":300,"wires":[]},{"id":"7c348293.52162c","type":"inject","z":"8b99f8fe.7b27b8","name":"Every 30 seconds","topic":"","payload":"","payloadType":"date","repeat":"30","crontab":"","once":false,"onceDelay":"","x":190,"y":340,"wires":[["e2460a6c.579118"]]},{"id":"6cef8202.47cb9c","type":"function","z":"8b99f8fe.7b27b8","name":"Determine device presence","func":"const lastSeenSeconds = 70;\nlet presenceCutoff = (new Date() - (lastSeenSeconds * 1000)) / 1000; \nconst people = {\n    \"presence/heggland\": \"heggland\",\n    \"presence/karina\": \"karina\",\n    \"presence/person3\": \"stian\"\n};\n\nreturn Object.keys(people).map(function(topic) {\n    let devices = msg.payload[0].filter(device => device.name === people[topic] && device.last_seen > presenceCutoff);\n    return {\n        topic: topic,\n        retain: true,\n        payload: devices.length > 0\n    };\n});","outputs":3,"noerr":0,"x":340,"y":380,"wires":[["d5a9cb0d.738118","394f6d15.3c43e2","9d5a29ac.ba5878"],["d5a9cb0d.738118","394f6d15.3c43e2","7f16d91b.b91a58"],["394f6d15.3c43e2"]],"outputLabels":["michael presence","meredith presence",""]},{"id":"f0615fd.9f26ba","type":"function","z":"8b99f8fe.7b27b8","name":"Home","func":"msg.payload = {\"mode\":\"home\"};\nglobal.set(\"Mode\", \"home\")\nreturn msg;","outputs":1,"noerr":0,"x":1790,"y":340,"wires":[["247260f.c82dca","1d5d3947.5957f7"]]},{"id":"e4c32eed.12537","type":"function","z":"8b99f8fe.7b27b8","name":"Away","func":"msg.payload = {\"mode\":\"away\"};\nglobal.set(\"Mode\", \"away\")\nreturn msg;","outputs":1,"noerr":0,"x":1790,"y":420,"wires":[["fc4fe81e.444628","1d5d3947.5957f7"]]},{"id":"fb8b8d41.ce033","type":"comment","z":"edb6b263.c07ca","name":"Presence","info":"","x":135,"y":63.33333206176758,"wires":[]},{"id":"b5111b24.f5bbe8","type":"function","z":"edb6b263.c07ca","name":"Determine device presence","func":"const lastSeenSeconds = 100;\nlet presenceCutoff = (new Date() - (lastSeenSeconds * 1000)) / 1000; \nconst people = {\n    \"presence/person1\": \"Motorola\",\n    \"presence/person2\": \"Identifier2\",\n    \"presence/person3\": \"Identifier2\"\n};\n\nreturn Object.keys(people).map(function(topic) {\n    let devices = msg.payload[0].filter(device => device.name === people[topic] && device.last_seen > presenceCutoff);\n    return {\n        topic: topic,\n        retain: true,\n        payload: devices.length > 0\n    };\n});","outputs":3,"noerr":0,"x":653.9999961853027,"y":100.33333492279053,"wires":[["218af2de.fefcbe"],["d76d38e2.ca61e8"],["2a722fd5.edc2a"]],"outputLabels":["michael presence","meredith presence",""]},{"id":"218af2de.fefcbe","type":"rbe","z":"edb6b263.c07ca","name":"","func":"rbe","gap":"","start":"","inout":"out","x":859.0000076293945,"y":59.33333206176758,"wires":[[]]},{"id":"2f1c7777.e08d18","type":"debug","z":"edb6b263.c07ca","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1470.1001167297363,"y":159.33333492279053,"wires":[]},{"id":"b1aee17e.bf184","type":"function","z":"edb6b263.c07ca","name":"Home","func":"msg.payload = {\"mode\":\"home\"};\nreturn msg;","outputs":1,"noerr":0,"x":1249.100112915039,"y":107.33333396911621,"wires":[["2f1c7777.e08d18"]]},{"id":"17936d13.2bd563","type":"function","z":"edb6b263.c07ca","name":"Away","func":"msg.payload = {\"mode\":\"away\"};\nreturn msg;","outputs":1,"noerr":0,"x":1254.000015258789,"y":165.3333330154419,"wires":[["2f1c7777.e08d18"]]},{"id":"d76d38e2.ca61e8","type":"rbe","z":"edb6b263.c07ca","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":857.9999961853027,"y":101.33333110809326,"wires":[[]]},{"id":"2a722fd5.edc2a","type":"rbe","z":"edb6b263.c07ca","name":"","func":"rbe","gap":"","start":"","inout":"out","x":857.9999961853027,"y":144.33333110809326,"wires":[[]]},{"id":"76623d17.844704","type":"function","z":"8b99f8fe.7b27b8","name":"Text: English","func":"msg.payload = \"Welcome Home Karina\";\nmsg.emitVolume = 50;\nreturn msg;","outputs":1,"noerr":0,"x":1770,"y":540,"wires":[[]]},{"id":"4f6a8027.a60f6","type":"function","z":"8b99f8fe.7b27b8","name":"Text: Norsk","func":"msg.payload = \"Velkommen Hjem Karina\";\nmsg.emitVolume = 50;\nreturn msg;","outputs":1,"noerr":0,"x":1770,"y":580,"wires":[["eb9070bf.75d39"]]},{"id":"326c7017.9736f","type":"function","z":"8b99f8fe.7b27b8","name":"Text: Russisk","func":"msg.payload = \"Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð¾Ð¼Ð¾Ð¹ ÐšÐ°Ñ€Ð¸Ð½Ð°\";\nmsg.emitVolume = 50;\nreturn msg;","outputs":1,"noerr":0,"x":1770,"y":620,"wires":[[]]},{"id":"7b77820d.6721dc","type":"switch","z":"8b99f8fe.7b27b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1270,"y":520,"wires":[["46c1d472.2e39ac"]]},{"id":"97214adf.ddc488","type":"trigger","z":"85114e25.ae2ad","op1":"","op2":"{\"power\":\"off\"}","op1type":"nul","op2type":"json","duration":"30","extend":true,"units":"min","reset":"A","bytopic":"all","name":"delay_off_evning","x":2090,"y":620,"wires":[["755efaaf.da6674"]]},{"id":"dd48ccc.2391c3","type":"function","z":"85114e25.ae2ad","name":"msg.reset","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":1820,"y":500,"wires":[["97214adf.ddc488","89ed4b9.11a67b8","5a1ac503.81491c"]]},{"id":"9c18ec5f.f9594","type":"inject","z":"bc3b2c68.b35f6","name":"INFORM","topic":"","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"x":100,"y":40,"wires":[["47a496d1.bcac18","6a421ae3.f71ae4"]]},{"id":"ae47dd19.04f86","type":"inject","z":"bc3b2c68.b35f6","name":"GO","topic":"","payload":"GO","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":70,"y":340,"wires":[["47a496d1.bcac18"]]},{"id":"38b19a16.a4b306","type":"inject","z":"bc3b2c68.b35f6","name":"","topic":"","payload":"STOP","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":70,"y":380,"wires":[["47a496d1.bcac18"]]},{"id":"3b05335c.ab790c","type":"function","z":"bc3b2c68.b35f6","name":"Text: English","func":"msg.payload = \"Please Remember to Take out the TRASH\";\nmsg.emitVolume = 50;\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":260,"wires":[["7db434df.a3db2c"]]},{"id":"9430e52f.746a78","type":"function","z":"bc3b2c68.b35f6","name":"Text: English","func":"msg.payload = \"Please Remember to Take out the TRASH\";\nmsg.topic = \"Remember Garbage\";\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":220,"wires":[["c0005e0c.a1014"]]},{"id":"37115d31.12a892","type":"switch","z":"bc3b2c68.b35f6","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":20,"wires":[["584db3f7.80672c"],["757cb634.cb61d8"]]},{"id":"584db3f7.80672c","type":"change","z":"bc3b2c68.b35f6","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"GO","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":20,"wires":[["47a496d1.bcac18"]]},{"id":"757cb634.cb61d8","type":"change","z":"bc3b2c68.b35f6","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"STOP","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":60,"wires":[["47a496d1.bcac18"]]},{"id":"7297b009.f403c","type":"link out","z":"85114e25.ae2ad","name":"","links":["1329b56.bea634b"],"x":1975,"y":180,"wires":[]},{"id":"d97a92f4.627f3","type":"link out","z":"9318493b.8ed8b8","name":"","links":["1329b56.bea634b"],"x":1635,"y":120,"wires":[]},{"id":"1329b56.bea634b","type":"link in","z":"8b99f8fe.7b27b8","name":"","links":["d97a92f4.627f3","7297b009.f403c"],"x":195,"y":720,"wires":[["61ee7057.5df1f"]]},{"id":"55a1471c.7ca3e8","type":"trigger","z":"8b99f8fe.7b27b8","op1":"","op2":"true","op1type":"nul","op2type":"bool","duration":"30","extend":true,"units":"min","reset":"","bytopic":"all","name":"","x":630,"y":780,"wires":[["98590ccf.4b78b","a085a6f7.ae8698"]]},{"id":"89ed4b9.11a67b8","type":"trigger","z":"85114e25.ae2ad","op1":"","op2":"{\"power\":\"off\"}","op1type":"nul","op2type":"json","duration":"5","extend":true,"units":"min","reset":"A","bytopic":"all","name":"delay_off_night","x":2080,"y":580,"wires":[["755efaaf.da6674"]]},{"id":"c0a1cf4a.15698","type":"comment","z":"85114e25.ae2ad","name":"Stue","info":"","x":590,"y":40,"wires":[]},{"id":"cab5d077.abb8d","type":"comment","z":"85114e25.ae2ad","name":"Gangen","info":"","x":250,"y":320,"wires":[]},{"id":"b22a9370.cae85","type":"mqtt in","z":"85114e25.ae2ad","name":"","topic":"gangen","qos":"1","datatype":"utf8","broker":"f6aee802.f74bc8","x":570,"y":760,"wires":[["868abce4.e6b35"]]},{"id":"5a1ac503.81491c","type":"trigger","z":"85114e25.ae2ad","op1":"","op2":"{\"power\":\"off\"}","op1type":"nul","op2type":"json","duration":"11","extend":true,"units":"min","reset":"A","bytopic":"all","name":"delay_off_day","x":2080,"y":660,"wires":[["755efaaf.da6674"]]},{"id":"fc87af9f.856a6","type":"json","z":"85114e25.ae2ad","name":"","property":"payload","action":"","pretty":false,"x":490,"y":220,"wires":[["14a2d20d.f8eade"]]},{"id":"48797fde.8012e","type":"switch","z":"85114e25.ae2ad","name":"Presence","property":"payload.devices.presence","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":true,"outputs":2,"x":1660,"y":140,"wires":[["dd48ccc.2391c3","c6040a53.209f58","38c7d145.d78a6e"],["7297b009.f403c","4038428a.500f2c"]]},{"id":"2183112b.d9b2ee","type":"json","z":"9318493b.8ed8b8","name":"","property":"payload","action":"","pretty":false,"x":310,"y":200,"wires":[["bde23867.90b558"]]},{"id":"bde23867.90b558","type":"switch","z":"9318493b.8ed8b8","name":"","property":"guestmode","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":true,"outputs":1,"x":430,"y":200,"wires":[["14d4c15d.0b6a7f"]]},{"id":"14a2d20d.f8eade","type":"switch","z":"85114e25.ae2ad","name":"","property":"guestmode","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":true,"outputs":1,"x":610,"y":220,"wires":[["59179383.4e18cc","f8944aeb.38fec8","6c54c6c8.7ee968"]]},{"id":"fed2f17a.dc43","type":"device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"21","device_id":"21","name":"Gangen","x":150,"y":380,"wires":[["317079cf.c65136"]]},{"id":"acec5dd3.74aae","type":"device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"5","device_id":"5","name":"Kontor: Lys","x":160,"y":440,"wires":[["a568df99.b3c63"]]},{"id":"5ff8681c.2de298","type":"device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"15","device_id":"15","name":"Vaskerom: Lys","x":120,"y":620,"wires":[["ec10ea54.60f388","ad9a81e7.830c3"]]},{"id":"e4ddb22f.af1f4","type":"device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"20","device_id":"20","name":"Karina ","x":150,"y":700,"wires":[["c72a7605.efa9f8","b6062edf.85f6f"]]},{"id":"550dc5dc.fb76bc","type":"device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"17","device_id":"17","name":"Kjeller Gang","x":130,"y":740,"wires":[["dea49660.ff62b8","1e1b8bbf.4eac74"]]},{"id":"a501e829.fe8c58","type":"device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"9","device_id":"9","name":"Closet","x":150,"y":660,"wires":[["29e19499.e7495c","ee3e73ae.3c209"]]},{"id":"7eae1b1d.c5ef64","type":"device","z":"85114e25.ae2ad","user":"3fb4f73e.f3cd38","device":"23","device_id":"23","name":"Kitchen: eye","x":290,"y":220,"wires":[["fc87af9f.856a6"]]},{"id":"7433eb5f.c4b754","type":"device","z":"9318493b.8ed8b8","user":"3fb4f73e.f3cd38","device":"19","device_id":"19","name":"Kjeller: Eye","x":150,"y":200,"wires":[["2183112b.d9b2ee"]]},{"id":"b4d8f77c.d52bd8","type":"device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"10","device_id":"10","name":"Kjøkken","x":160,"y":500,"wires":[["adb79c73.b1286"]]},{"id":"abecb95.a0b1048","type":"device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"11","device_id":"11","name":"Stue","x":150,"y":560,"wires":[["4957819.8fe9e8"]]},{"id":"1d5d3947.5957f7","type":"mode","z":"8b99f8fe.7b27b8","user":"3fb4f73e.f3cd38","name":"Home mode","mode":"home","x":2110,"y":380,"wires":[]},{"id":"27537a62.39b306","type":"mode","z":"8b99f8fe.7b27b8","user":"3fb4f73e.f3cd38","name":"Sleep mode","mode":"sleep","x":1050,"y":780,"wires":[]},{"id":"580e22c4.a8ebac","type":"change-device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"11","device_id":"11","name":"Stue","x":1970,"y":560,"wires":[]},{"id":"b3b75b9a.20c1a8","type":"change-device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"10","device_id":"10","name":"Kjøkken","x":1980,"y":600,"wires":[]},{"id":"87ef4cd9.24919","type":"change-device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"17","device_id":"17","name":"Kjeller Gang","x":1990,"y":640,"wires":[]},{"id":"b7aa8b08.2d6208","type":"change-device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"15","device_id":"15","name":"Vaskerom: Lys","x":2000,"y":680,"wires":[]},{"id":"7ebcbc9e.7409d4","type":"change-device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"9","device_id":"9","name":"Closet","x":1970,"y":720,"wires":[]},{"id":"d6c2e23f.d29f8","type":"change-device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"20","device_id":"20","name":"Karina ","x":1970,"y":760,"wires":[]},{"id":"fc79aea8.12ce5","type":"change-device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"5","device_id":"5","name":"Kontor: Lys","x":1990,"y":840,"wires":[]},{"id":"ca0455.e1f13ba8","type":"change-device","z":"1c11632f.f206fd","user":"3fb4f73e.f3cd38","device":"21","device_id":"21","name":"Gangen","x":1980,"y":800,"wires":[]},{"id":"9d48c4c4.58d7f8","type":"ui_button","z":"9318493b.8ed8b8","name":"Off","group":"ca3eef.3da5b11","order":1,"width":0,"height":0,"passthru":true,"label":"OFF","tooltip":"","color":"","bgcolor":"","icon":"","payload":"0","payloadType":"str","topic":"LAB/OVERRIDE/","x":970,"y":100,"wires":[["74d16771.1acde8"]]},{"id":"2a95c76f.03fc68","type":"ui_button","z":"9318493b.8ed8b8","name":"On","group":"ca3eef.3da5b11","order":3,"width":0,"height":0,"passthru":true,"label":"ON","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"LAB/OVERRIDE/","x":970,"y":140,"wires":[["74d16771.1acde8"]]},{"id":"69a2c456.80ad2c","type":"ui_button","z":"9318493b.8ed8b8","name":"Auto","group":"ca3eef.3da5b11","order":2,"width":0,"height":0,"passthru":true,"label":"AUTO","tooltip":"","color":"","bgcolor":"","icon":"","payload":"A","payloadType":"str","topic":"LAB/OVERRIDE/","x":970,"y":60,"wires":[["74d16771.1acde8"]]},{"id":"bbde75e4.9e1d28","type":"ui_button","z":"85114e25.ae2ad","name":"Off","group":"efd0ae.1a06bf5","order":1,"width":0,"height":0,"passthru":false,"label":"OFF","tooltip":"","color":"","bgcolor":"","icon":"","payload":"0","payloadType":"str","topic":"LAB/OVERRIDE/","x":1270,"y":460,"wires":[["7e76be9d.400b7"]]},{"id":"ef24647a.c25548","type":"ui_button","z":"85114e25.ae2ad","name":"On","group":"efd0ae.1a06bf5","order":3,"width":0,"height":0,"passthru":false,"label":"ON","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"LAB/OVERRIDE/","x":1270,"y":540,"wires":[["7e76be9d.400b7"]]},{"id":"7fa10057.36d61","type":"ui_button","z":"85114e25.ae2ad","name":"Auto","group":"efd0ae.1a06bf5","order":2,"width":0,"height":0,"passthru":true,"label":"AUTO","tooltip":"","color":"","bgcolor":"","icon":"","payload":"A","payloadType":"str","topic":"LAB/OVERRIDE/","x":1270,"y":500,"wires":[["7e76be9d.400b7","dd48ccc.2391c3"]]},{"id":"28f59771.b88068","type":"ui_button","z":"bc3b2c68.b35f6","name":"STOP","group":"56a8be2a.9b9eb","order":5,"width":0,"height":0,"passthru":false,"label":"Søppel","tooltip":"Trykk når søppel tatt ut","color":"","bgcolor":"","icon":"","payload":"STOP","payloadType":"str","topic":"FALSE","x":70,"y":300,"wires":[["47a496d1.bcac18"]]},{"id":"e24d6f6a.515a6","type":"ui_toast","z":"bc3b2c68.b35f6","position":"top right","displayTime":"10","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"Husk SÃ¸ppel","name":"Husk SÃ¸ppel","x":490,"y":180,"wires":[]},{"id":"343547fd.e77fb8","type":"ui_template","z":"1c11632f.f206fd","group":"8a264f87.d9145","name":"1 ETG","order":1,"width":9,"height":11,"format":"<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js\"></script>\n</head>\n<body style=\"margin: 0px;\">\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"450\" height=\"800\"  xml:space=\"preserve\" id=\"i02XXX\">\n    <!-- Generated by PaintCode - http://www.paintcodeapp.com -->\n    <defs>\n        <pattern id=\"i1floorPlan\" patternUnits=\"userSpaceOnUse\" width=\"450\" height=\"600\" align=\"middle\">\n            <image xlink:href=\"http://toyotacarina.net/SmartHome/1stFloor.jpg\" x=\"0\" y=\"0\" width=\"450\" height=\"600\" align=\"middle\"></image>\n        </pattern>\n    </defs>\n    <rect id=\"i02XXX-floorPlan\" stroke=\"none\" fill=\"url(#i1floorPlan)\" x=\"0\" y=\"0\" width=\"450\" height=\"600\" align=\"middle\"></rect>\n    <g id=\"i02XXX-allSensors\">\n        <g id=\"i02XXX-motionSensors\" opacity=\"0.5\">\n            \n            <g id=\"Livingroom\" transform=\"translate(430,408) rotate(90)\">\n                <svg class=\"svg-rect\" width=\"149\" height=\"67\">\n                    <rect id=\"Stue\" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Lys i stue</text>\n                </svg>\n            </g>\n               <g id=\"KarinasOffice\" transform=\"translate(430,40) rotate(90)\">\n                <svg class=\"svg-rect\" width=\"149\" height=\"67\">\n                    <rect id=\"Karinas office\" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Karinas office</text>\n                </svg>\n            </g>\n            <g id=\"Kitchen\" transform=\"translate(0,510)\">\n                <svg class=\"svg-rect\" width=\"221\" height=\"75\">\n                    <rect id=\"Kjøkken\" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Kjøkken lys</text>\n                </svg>  \n            </g>\n             <g id=\"Gusetroom\" transform=\"translate(0,170)\">\n                <svg class=\"svg-rect\" width=\"150\" height=\"75\">\n                    <rect id=\"Kontor: Lys\" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Guestroom lys</text>\n                </svg>                \n            </g>\n             <g id=\"Gang\" transform=\"translate(170,50)\">\n                <svg class=\"svg-rect\" width=\"150\" height=\"75\">\n                    <rect id=\"Gangen\" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Gang</text>\n                </svg>                \n            </g>\n        </g>\n    </g>\n</svg>\n\n<script>\nvar light = \"on\";\nvar name = \"lys\";\nvar retur = \"mothing\";\nfunction myFunction(clicked_id) {\n    \n    //  document.getElementById(clicked_id).style.fill=\"yellow\";\n   var fill = document.getElementById(clicked_id).style.fill;\n    if (fill ==  \"yellow\")  {\n    document.getElementById(clicked_id).style.fill=\"white\";\n    light = \"off\";\n    name = clicked_id;\n  } else {\n    document.getElementById(clicked_id).style.fill=\"yellow\";\n    light = \"on\";\n     name = clicked_id;\n    \n  }\n \n}\n\nthis.scope.action = function() { return {\"power\" :light, \"name\": name }; }\n\n</script>\n<script>\n  (function(scope){ \n\tscope.$watch('msg', function(msg) {\n\t\tif (msg){\n\t\t    console.log(msg.payload.jquerySelector);\n\t\t    console.log(document.getElementById(String(msg.payload.jquerySelector)));\n\t\t\tif (msg.payload.status ==  \"off\")  {\n\t\t\t\tdocument.getElementById(String(msg.payload.jquerySelector)).style.fill=\"white\";\n\t\t\t} else {\n\t\t\t\tdocument.getElementById(String(msg.payload.jquerySelector)).style.fill=\"yellow\";\n\t\t\t}                     \n\t\t}\n\t});\n})(scope);\n</script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":1230,"y":580,"wires":[["c93d9ccb.30d74"]]},{"id":"db00bb8.82e0148","type":"ui_template","z":"1c11632f.f206fd","group":"8a264f87.d9145","name":"Basement","order":2,"width":9,"height":11,"format":"<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js\"></script>\n</head>\n<body style=\"margin: 0px;\">\n\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"450\" height=\"800\"  xml:space=\"preserve\" id=\"i01XXX\">\n    <!-- Generated by PaintCode - http://www.paintcodeapp.com -->\n    <defs>\n        <pattern id=\"basementPattern\" patternUnits=\"userSpaceOnUse\" width=\"450\" height=\"600\" align=\"middle\">\n            <image xlink:href=\"http://toyotacarina.net/SmartHome/Basement.jpg\" x=\"0\" y=\"0\" width=\"450\" height=\"600\" align=\"middle\"></image>\n        </pattern>\n    </defs>\n    <rect id=\"i01XXX-floorPlan\" stroke=\"none\" fill=\"url(#basementPattern)\" x=\"0\" y=\"0\" width=\"450\" height=\"600\" align=\"middle\"></rect>\n      <g id=\"i01XXX-allSensors\">\n        <g id=\"i01XXX-motionSensors\" opacity=\"0.5\">\n     <g id=\"Basement\" transform=\"translate(430,390) rotate(90)\">\n                <svg class=\"svg-rect\" width=\"200\" height=\"60\">\n                    <rect id=\"Kjeller Gang\" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Kjeller Lys</text>\n                </svg>                \n            </g>\n\t <g id=\"Vaskerom1\" transform=\"translate(170,20)\">\n                <svg class=\"svg-rect\" width=\"120\" height=\"100\">\n                    <rect id=\"Vaskerom: Lys\" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Vaskerom</text>\n                </svg>                \n            </g>\n\t<g id=\"Closet1\" transform=\"translate(310,20)\">\n                <svg class=\"svg-rect\" width=\"110\" height=\"170\">\n                    <rect id=\"Closet\" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Garderobe</text>\n                </svg>                \n            </g>\n    <g id=\"Soverommet\" transform=\"translate(20,400)\">\n                <svg class=\"svg-rect\" width=\"110\" height=\"130\">\n                    <rect id=\"Karina \" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Soverom</text>\n                </svg>                \n            </g>\n    <g id=\"Gardin\" transform=\"translate(60,550)\">\n                <svg class=\"svg-rect\" width=\"110\" height=\"40\">\n                    <rect id=\"Sov_Gardin\" onclick=\"myFunction(this.id)\" ng-click=\"send({payload: action()})\" width=\"100%\" height=\"100%\" stroke=\"none\" fill=\"white\" rx=\"13\" ></rect>\n                    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" stroke=\"black\" font-family=\"HelveticaNeue-Bold, 'Helvetica Neue', Helvetica, Arial, sans-serif\" font-weight=\"bold\" font-size=\"20\">Gardin</text>\n                </svg>                \n            </g>\n        </g>   \n    </g>  \n</svg>\n<script>\nvar light = \"on\";\nvar name = \"lys\";\nvar retur = \"mothing\";\nfunction myFunction(clicked_id) {\n    \n    //  document.getElementById(clicked_id).style.fill=\"yellow\";\n   var fill = document.getElementById(clicked_id).style.fill;\n    if (fill ==  \"yellow\")  {\n    document.getElementById(clicked_id).style.fill=\"white\";\n    light = \"off\";\n    name = clicked_id;\n  } else {\n    document.getElementById(clicked_id).style.fill=\"yellow\";\n    light = \"on\";\n     name = clicked_id;\n    \n  }\n \n}\n\nthis.scope.action = function() { return {\"power\" :light, \"name\": name }; }\n\n</script>\n<script>\n  (function(scope){ \n\tscope.$watch('msg', function(msg) {\n\t\tif (msg){\n\t\t    console.log(msg.payload.jquerySelector);\n\t\t    console.log(document.getElementById(String(msg.payload.jquerySelector)));\n\t\t\tif (msg.payload.status ==  \"off\")  {\n\t\t\t\tdocument.getElementById(String(msg.payload.jquerySelector)).style.fill=\"white\";\n\t\t\t} else {\n\t\t\t\tdocument.getElementById(String(msg.payload.jquerySelector)).style.fill=\"yellow\";\n\t\t\t}                     \n\t\t}\n\t});\n})(scope);\n</script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":1220,"y":660,"wires":[["c93d9ccb.30d74"]]},{"id":"c2c55e51.42bd2","type":"node-hue-out","z":"1c11632f.f206fd","server":"dccbff74.2769","lightID":"light8","name":"Karinas Office","x":170,"y":300,"wires":[["b60e383f.f82dc8"]]},{"id":"d937e7f8.315d88","type":"node-hue-in","z":"1c11632f.f206fd","server":"dccbff74.2769","lightID":"light8","name":"Karinas Office","x":2000,"y":900,"wires":[]},{"id":"6a421ae3.f71ae4","type":"bigtimer","z":"bc3b2c68.b35f6","outtopic":"","outpayload1":"","outpayload2":"","name":"Big Timer","comment":"","lat":"58.851299","lon":"5.748830","starttime":"1035","endtime":"1320","starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"GO","outtext2":"STOP","timeout":1440,"sun":false,"mon":false,"tue":true,"wed":false,"thu":false,"fri":false,"sat":false,"jan":true,"feb":false,"mar":false,"apr":false,"may":true,"jun":false,"jul":false,"aug":false,"sep":true,"oct":false,"nov":false,"dec":false,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":100,"y":120,"wires":[["47a496d1.bcac18"],["47a496d1.bcac18","37115d31.12a892"],[]]},{"id":"394f6d15.3c43e2","type":"and-gate","z":"8b99f8fe.7b27b8","name":"Er Borte","rules":[{"t":"false","propertyType":"msg","property":"payload","topic":"presence/heggland"},{"t":"false","propertyType":"msg","property":"payload","topic":"presence/person3"},{"t":"false","propertyType":"msg","property":"payload","topic":"presence/karina"}],"outputTopic":"Gone","gateType":"and","emitOnlyIfTrue":true,"x":700,"y":420,"wires":[["fc71e441.058a48"]]},{"id":"d5a9cb0d.738118","type":"or-gate","z":"8b99f8fe.7b27b8","name":"Er Hjemme","rules":[{"t":"true","propertyType":"msg","property":"payload","topic":"presence/heggland"},{"t":"true","propertyType":"msg","property":"payload","topic":"presence/karina"},{"t":"true","propertyType":"msg","property":"payload","topic":"presence/person3"}],"outputTopic":"Home","gateType":"or","emitOnlyIfTrue":true,"x":710,"y":340,"wires":[["16e01a0.bfa88e6"]]},{"id":"47a496d1.bcac18","type":"traffic","z":"bc3b2c68.b35f6","name":"Traffic sample","property_allow":"payload","filter_allow":"GO","ignore_case_allow":false,"negate_allow":false,"send_allow":false,"property_stop":"payload","filter_stop":"stop","ignore_case_stop":true,"negate_stop":false,"send_stop":false,"default_start":false,"differ":false,"x":280,"y":220,"wires":[["e24d6f6a.515a6","9430e52f.746a78","3b05335c.ab790c"]]},{"id":"e2460a6c.579118","type":"Unifi","z":"8b99f8fe.7b27b8","name":"Heggland","ip":"178.128.169.181","port":8443,"site":"7vyhbfa5","command":"20","x":140,"y":380,"wires":[["6cef8202.47cb9c"]]},{"id":"813f45c0.8ed288","type":"time-range-switch","z":"9318493b.8ed8b8","name":"","lat":"58.851468","lon":"5.748852","startTime":"06:45","endTime":"22:00","startOffset":0,"endOffset":0,"x":1690,"y":80,"wires":[["56c00304.d99d1c"],[]]},{"id":"f6618be.290b278","type":"time-range-switch","z":"85114e25.ae2ad","name":"","lat":"58.851468","lon":"5.748852","startTime":"06:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":2030,"y":140,"wires":[["e7bf0841.4cc108"],[]]},{"id":"61ee7057.5df1f","type":"time-range-switch","z":"8b99f8fe.7b27b8","name":"","lat":"58.851468","lon":"5.748852","startTime":"06:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":370,"y":720,"wires":[[],["ebfc5adc.7672f8"]]},{"id":"9d343772.7e9d28","type":"link in","z":"1c11632f.f206fd","name":"FH: STUE","links":["ad1069d2.d7fc68"],"x":1735,"y":560,"wires":[["580e22c4.a8ebac"]]},{"id":"a3313cc0.32da6","type":"link in","z":"1c11632f.f206fd","name":"FH: KjÃ¸kken","links":["11a31565.e6816b","ad1069d2.d7fc68"],"x":1735,"y":600,"wires":[["b3b75b9a.20c1a8"]]},{"id":"c44627f4.c21ff8","type":"link in","z":"1c11632f.f206fd","name":"FH: kjeller","links":["f9c32e8a.e6559"],"x":1735,"y":640,"wires":[["3f2ad883.c0a158"]]},{"id":"23722a88.e69266","type":"link in","z":"1c11632f.f206fd","name":"FH:  vaskerom","links":[],"x":1735,"y":680,"wires":[["aa0b6d5d.1543d"]]},{"id":"5819f17f.03053","type":"link in","z":"1c11632f.f206fd","name":"FH:  closet","links":[],"x":1735,"y":720,"wires":[["fa7fd71b.8663d8"]]},{"id":"1e2040cb.792cef","type":"link in","z":"1c11632f.f206fd","name":"FH: : soverom","links":[],"x":1735,"y":760,"wires":[["49262ade.9116a4"]]},{"id":"6b77185b.319ec8","type":"link in","z":"1c11632f.f206fd","name":"FH:  gang","links":["4a9df2a6.db9e6c"],"x":1735,"y":800,"wires":[["ca0455.e1f13ba8"]]},{"id":"f98da519.bc00c8","type":"link in","z":"1c11632f.f206fd","name":"FH:  kontor","links":[],"x":1735,"y":840,"wires":[["eb7e9e84.10e46"]]},{"id":"23a68d63.954c32","type":"link out","z":"1c11632f.f206fd","name":"FH: kjÃ¸kken","links":["ecf3f36.dd54b1"],"x":535,"y":380,"wires":[]},{"id":"5ac37302.75a94c","type":"link out","z":"1c11632f.f206fd","name":"FH: stue","links":["ecf3f36.dd54b1"],"x":515,"y":440,"wires":[]},{"id":"4f4fd26d.04d17c","type":"link out","z":"1c11632f.f206fd","name":"FH:  kjøkken","links":["cc9e00d3.300e7"],"x":735,"y":380,"wires":[]},{"id":"8979d93a.616b28","type":"link out","z":"1c11632f.f206fd","name":"FH:  gangen","links":["cc9e00d3.300e7"],"x":735,"y":420,"wires":[]},{"id":"ec10ea54.60f388","type":"link out","z":"1c11632f.f206fd","name":"FH: vaskerom","links":[],"x":515,"y":620,"wires":[]},{"id":"29e19499.e7495c","type":"link out","z":"1c11632f.f206fd","name":"FH:  closet","links":[],"x":515,"y":660,"wires":[]},{"id":"c72a7605.efa9f8","type":"link out","z":"1c11632f.f206fd","name":"FH:  soverom","links":[],"x":515,"y":700,"wires":[]},{"id":"dea49660.ff62b8","type":"link out","z":"1c11632f.f206fd","name":"FH:  kjeller","links":[],"x":515,"y":740,"wires":[]},{"id":"4a9df2a6.db9e6c","type":"link out","z":"85114e25.ae2ad","name":"","links":["6b77185b.319ec8"],"x":1395,"y":700,"wires":[]},{"id":"ad1069d2.d7fc68","type":"link out","z":"85114e25.ae2ad","name":"","links":["9d343772.7e9d28","a3313cc0.32da6"],"x":2455,"y":340,"wires":[]},{"id":"f9c32e8a.e6559","type":"link out","z":"9318493b.8ed8b8","name":"","links":["c44627f4.c21ff8"],"x":2055,"y":280,"wires":[]},{"id":"ea100c04.f677b","type":"googlehome-notify","z":"1c11632f.f206fd","server":"d1934670.897a88","name":"Kjeller: Norsk","x":2010,"y":200,"wires":[]},{"id":"1dd6721c.ecdc0e","type":"googlehome-notify","z":"1c11632f.f206fd","server":"a967d384.f5115","name":"Kjeller:RU","x":2000,"y":240,"wires":[]},{"id":"e938ee3e.149e9","type":"googlehome-notify","z":"1c11632f.f206fd","server":"5ee6b185.35f2d","name":"Stue:RU","x":2000,"y":340,"wires":[]},{"id":"f8249219.9cc45","type":"googlehome-notify","z":"1c11632f.f206fd","server":"35cb409b.4a073","name":"Kjeller:english","x":2020,"y":280,"wires":[]},{"id":"2bfd1c76.96d4a4","type":"googlehome-notify","z":"1c11632f.f206fd","server":"354eb0bd.91999","name":"Stue:English","x":2030,"y":380,"wires":[]},{"id":"d09cfa06.b99e18","type":"googlehome-notify","z":"1c11632f.f206fd","server":"429b8253.24d1dc","name":"Stue: NO","x":2000,"y":420,"wires":[]},{"id":"e239cc32.ce75b","type":"link in","z":"1c11632f.f206fd","name":"GH: Kjeller: NO","links":[],"x":1735,"y":200,"wires":[["ea100c04.f677b"]]},{"id":"be178b19.a730f8","type":"link in","z":"1c11632f.f206fd","name":"GH: Kjeller:  RU","links":[],"x":1735,"y":240,"wires":[["1dd6721c.ecdc0e"]]},{"id":"c9b1af2b.75dac","type":"link in","z":"1c11632f.f206fd","name":"GH: Kjeller: ENG","links":[],"x":1735,"y":280,"wires":[["f8249219.9cc45"]]},{"id":"342f3c87.de1764","type":"link in","z":"1c11632f.f206fd","name":"GH: Stue: RU","links":[],"x":1735,"y":340,"wires":[["e938ee3e.149e9"]]},{"id":"fee9f406.ef48d8","type":"link in","z":"1c11632f.f206fd","name":"GH: Stue: ENG","links":["6c568696.26a908","7db434df.a3db2c","976db23e.1f8ba"],"x":1735,"y":380,"wires":[["9702e016.0991d"]]},{"id":"d8761e25.88f1d","type":"link in","z":"1c11632f.f206fd","name":"GH: Stue: NO","links":["eb9070bf.75d39"],"x":1735,"y":420,"wires":[["d09cfa06.b99e18"]]},{"id":"6c568696.26a908","type":"link out","z":"8b99f8fe.7b27b8","name":"","links":["fee9f406.ef48d8"],"x":1915,"y":540,"wires":[]},{"id":"eb9070bf.75d39","type":"link out","z":"8b99f8fe.7b27b8","name":"","links":["d8761e25.88f1d"],"x":1915,"y":580,"wires":[]},{"id":"f9b48afc.eac988","type":"link out","z":"8b99f8fe.7b27b8","name":"","links":[],"x":1915,"y":620,"wires":[]},{"id":"7db434df.a3db2c","type":"link out","z":"bc3b2c68.b35f6","name":"","links":["fee9f406.ef48d8"],"x":615,"y":260,"wires":[]},{"id":"662a4780.2e8b58","type":"inject","z":"1c11632f.f206fd","name":"Set Button value False","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":"1","x":760,"y":1060,"wires":[["27fdfe44.08c092","4b175a54.957e04"]]},{"id":"abc919e5.247498","type":"change","z":"1c11632f.f206fd","name":"","rules":[{"t":"set","p":"guestmode","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":1040,"wires":[[]]},{"id":"27fdfe44.08c092","type":"ui_switch","z":"1c11632f.f206fd","name":"","label":"Gjestemodus","tooltip":"","group":"56a8be2a.9b9eb","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1084.9999923706055,"y":1058.9999990463257,"wires":[["abc919e5.247498"]]},{"id":"b37115c7.7aec28","type":"mqtt out","z":"1c11632f.f206fd","name":"IdLock","topic":"door","qos":"0","retain":"true","broker":"f6aee802.f74bc8","x":1530,"y":1140,"wires":[]},{"id":"180d4919.ebc497","type":"mqtt in","z":"1c11632f.f206fd","name":"IdLock","topic":"door","qos":"0","datatype":"auto","broker":"f6aee802.f74bc8","x":710,"y":1220,"wires":[["70c2d3e0.6beb1c"]]},{"id":"65aebf9e.3fbf3","type":"ui_switch","z":"1c11632f.f206fd","name":"bryter","label":"{{label}}","tooltip":"","group":"56a8be2a.9b9eb","order":3,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"0","onvalueType":"str","onicon":"fa-sun-o","oncolor":"red","offvalue":"255","offvalueType":"str","officon":"fa-cloud","offcolor":"Green","x":1070,"y":1140,"wires":[["d6443c6.56eebc","b37115c7.7aec28"]]},{"id":"2144d2ba.acf10e","type":"trigger","z":"1c11632f.f206fd","op1":"","op2":"DÃ¸r er Ã¥pen","op1type":"nul","op2type":"str","duration":"15","extend":false,"units":"min","reset":"","bytopic":"all","name":"","x":1070,"y":1220,"wires":[["43b1426e.54fabc","a74103c4.1b297"]]},{"id":"e7746f47.54cbc","type":"link out","z":"1c11632f.f206fd","name":"","links":["9d6f976b.5d59f8"],"x":1435,"y":1220,"wires":[]},{"id":"c0005e0c.a1014","type":"link out","z":"bc3b2c68.b35f6","name":"SÃ¸ppel_Push","links":["9d6f976b.5d59f8"],"x":615,"y":220,"wires":[]},{"id":"e812b99e.e523f8","type":"pushbullet","z":"1c11632f.f206fd","config":"530528aa.2006c8","pushtype":"note","title":"","chan":"","name":"Notification","x":1990,"y":480,"wires":[]},{"id":"9d6f976b.5d59f8","type":"link in","z":"1c11632f.f206fd","name":"Pushbullet","links":["e7746f47.54cbc","c0005e0c.a1014","976db23e.1f8ba"],"x":1735,"y":480,"wires":[["e812b99e.e523f8"]]},{"id":"43b1426e.54fabc","type":"function","z":"1c11632f.f206fd","name":"Døren er Åpen","func":"msg.payload = \"Sjekk dÃ¸r, den er Ã¥pen\";\nmsg.topic = \"DÃ¸ren er Ã¥pen\";\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":1220,"wires":[["e7746f47.54cbc"]]},{"id":"bba53ecb.3b642","type":"change","z":"1c11632f.f206fd","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":1260,"wires":[["2144d2ba.acf10e"]]},{"id":"7c801509.abaafc","type":"comment","z":"1c11632f.f206fd","name":"Åpne / Sjekk døren","info":"","x":680,"y":1140,"wires":[]},{"id":"e7bf0841.4cc108","type":"change","z":"85114e25.ae2ad","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"dimValue\":\"100\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":280,"wires":[["ad1069d2.d7fc68"]]},{"id":"a229ca6a.d23bc8","type":"change","z":"85114e25.ae2ad","name":"ON","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"power\":\"on\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":760,"wires":[["4a9df2a6.db9e6c"]]},{"id":"3d0500d4.3e135","type":"change","z":"85114e25.ae2ad","name":"Off","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"power\":\"off\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":800,"wires":[["4a9df2a6.db9e6c"]]},{"id":"70c2d3e0.6beb1c","type":"function","z":"1c11632f.f206fd","name":"","func":"if (msg.payload === \"0\"){\n   msg.label = \"Dør¸r åpen\" \n   return [msg]\n} else {\n     msg.label = \"Dør Lukket\" \n     return [msg,msg]\n}\n\n","outputs":2,"noerr":0,"x":870,"y":1220,"wires":[["65aebf9e.3fbf3","2144d2ba.acf10e"],["bba53ecb.3b642"]]},{"id":"8d968981.156258","type":"comment","z":"1c11632f.f206fd","name":"Knapper","info":"","x":900,"y":1000,"wires":[]},{"id":"8966eae8.dc3588","type":"time-range-switch","z":"85114e25.ae2ad","name":"","lat":"58.851468","lon":"5.748852","startTime":"16:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":1830,"y":620,"wires":[["97214adf.ddc488"],["8d0c00eb.ae5f4"]]},{"id":"4038428a.500f2c","type":"time-range-switch","z":"85114e25.ae2ad","name":"","lat":"58.851468","lon":"5.748852","startTime":"06:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":1830,"y":580,"wires":[["8966eae8.dc3588"],["89ed4b9.11a67b8"]]},{"id":"8cb7a4a6.a97738","type":"trigger","z":"9318493b.8ed8b8","op1":"","op2":"{ \"power\": \"off\"}","op1type":"nul","op2type":"json","duration":"15","extend":true,"units":"min","reset":"A","bytopic":"all","name":"Turn OFF:DAY","x":1720,"y":160,"wires":[["f9c32e8a.e6559"]]},{"id":"12c8afec.724da","type":"link in","z":"8b99f8fe.7b27b8","name":"","links":["15f11a5d.7f2bb6","c6040a53.209f58"],"x":195,"y":780,"wires":[["fdbf838e.f9e58","e1dcab5a.66f5f8"]]},{"id":"fdbf838e.f9e58","type":"change","z":"8b99f8fe.7b27b8","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":780,"wires":[["55a1471c.7ca3e8"]]},{"id":"c6040a53.209f58","type":"link out","z":"85114e25.ae2ad","name":"1 etg: movement","links":["12c8afec.724da"],"x":1975,"y":100,"wires":[]},{"id":"15f11a5d.7f2bb6","type":"link out","z":"9318493b.8ed8b8","name":"kjller:  Movement","links":["12c8afec.724da"],"x":1635,"y":40,"wires":[]},{"id":"a74103c4.1b297","type":"change","z":"1c11632f.f206fd","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1280,"y":1180,"wires":[[]]},{"id":"e6504fc5.e2fc2","type":"inject","z":"85114e25.ae2ad","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"2","x":1130,"y":500,"wires":[["7fa10057.36d61"]]},{"id":"ddc8b687.374538","type":"deconz-input","z":"1b14ec1b.20ab54","name":"","server":"12895ae7.9c6bf5","device":"00:15:8d:00:01:4a:08:f7-01-0006","device_name":"Happy sulten : ZHASwitch","state":"buttonevent","output":"always","outputAtStartup":false,"x":270,"y":80,"wires":[["547e3ce0.793284"],[]]},{"id":"547e3ce0.793284","type":"function","z":"1b14ec1b.20ab54","name":"Happy outside ","func":"msg.payload = \"Happy wants to go outside\";\nmsg.emitVolume =50;\nlet msg2 = {};\nmsg2.payload = [ {\n        \"title\": \"Outside\",\n        \"description\": \"Happy wants to go Outside\",\n        \"icon\": \"https://lh3.googleusercontent.com/F7dHEApWlOufIKF5NX7EHtx1VTPfKWRIN-bOMch2Mi5eixq7cASp-Jh4kr2T4u5l5OUwkhZgowOD6HSOvnnSDi14oaDkREKSmejYnyOujkuSUw5mkIr_AqgIkZro25qWezWl3jxMwv-yTNCzPGV_ABugX9malJX4ZMEumc0cz5wQHsJxfh334ayq_yAslDd7cRzVytebggUPZ7kzxiWYtNAPZLzuOhZLu831adN6OM91wD7glPQoticU3Lh97Hzi1bHI55CEsMuY0DI4jIGlHCkhziI7Xm3FoZCjqX467O5uqKxHzdsamQ9FLGPquo7xr5FBaFUlrwtYoliH1kfSLEVF5C2b_zwErbcjQPCmKyPWQiUthDLvtcatWZ-zC7XmZb3knlSdb_ecwFmbm5lyn0krvtDU123uynS_xLK2C8uXhUP_A3r2msHBEIqrQoDP3HCHlJl2rOQ77Mxgh1uqUCZTT2EUGs67B-beYgbVcd_8wydZfHl6Pn4LP04yilrP3yCZtPT9zC_j-XM4AH_5kunbXytenZHLteaI4ppe4u9lnRCjX5nq8vshrXfOJINr_XvBbUQRHb1uUxQ9N0R_a8i7McUanKl06SX967PMOl9mxSC4LrisMzTj4KoWATsVCU8oXeo6DEsx-l0ICLeLven98hfoAFZym6jPVhBbUmZF7c_IGuqEgUvDw0HI1jc5uATSRxz-7YDELuDpAz4DKQBMMToV-yZdpNQXsM3zpu1Je7j9nA=w563-h545-no\"\n    }];\n\nreturn [msg, msg2];","outputs":2,"noerr":0,"x":520,"y":80,"wires":[["976db23e.1f8ba"],["9ab1a383.0f88b"]]},{"id":"976db23e.1f8ba","type":"link out","z":"1b14ec1b.20ab54","name":"","links":["9d6f976b.5d59f8","fee9f406.ef48d8"],"x":760,"y":80,"wires":[]},{"id":"eb90ae51.1af18","type":"deconz-input","z":"1b14ec1b.20ab54","name":"","server":"12895ae7.9c6bf5","device":"00:15:8d:00:01:9d:e5:2c-01-0006","device_name":"Happy vil ut : ZHASwitch","state":"buttonevent","output":"always","outputAtStartup":false,"x":270,"y":140,"wires":[["4f048068.a4401"],[]]},{"id":"4f048068.a4401","type":"function","z":"1b14ec1b.20ab54","name":"Happy hungry","func":"msg.payload = \"Happy is hungry\";\nmsg.emitVolume =50;\n\n\nlet msg2 = {};\nmsg2.payload = [ {\n        \"title\": \"Eat\",\n        \"description\": \"Happy wants to eat\",\n        \"icon\": \"https://lh3.googleusercontent.com/F7dHEApWlOufIKF5NX7EHtx1VTPfKWRIN-bOMch2Mi5eixq7cASp-Jh4kr2T4u5l5OUwkhZgowOD6HSOvnnSDi14oaDkREKSmejYnyOujkuSUw5mkIr_AqgIkZro25qWezWl3jxMwv-yTNCzPGV_ABugX9malJX4ZMEumc0cz5wQHsJxfh334ayq_yAslDd7cRzVytebggUPZ7kzxiWYtNAPZLzuOhZLu831adN6OM91wD7glPQoticU3Lh97Hzi1bHI55CEsMuY0DI4jIGlHCkhziI7Xm3FoZCjqX467O5uqKxHzdsamQ9FLGPquo7xr5FBaFUlrwtYoliH1kfSLEVF5C2b_zwErbcjQPCmKyPWQiUthDLvtcatWZ-zC7XmZb3knlSdb_ecwFmbm5lyn0krvtDU123uynS_xLK2C8uXhUP_A3r2msHBEIqrQoDP3HCHlJl2rOQ77Mxgh1uqUCZTT2EUGs67B-beYgbVcd_8wydZfHl6Pn4LP04yilrP3yCZtPT9zC_j-XM4AH_5kunbXytenZHLteaI4ppe4u9lnRCjX5nq8vshrXfOJINr_XvBbUQRHb1uUxQ9N0R_a8i7McUanKl06SX967PMOl9mxSC4LrisMzTj4KoWATsVCU8oXeo6DEsx-l0ICLeLven98hfoAFZym6jPVhBbUmZF7c_IGuqEgUvDw0HI1jc5uATSRxz-7YDELuDpAz4DKQBMMToV-yZdpNQXsM3zpu1Je7j9nA=w563-h545-no\"\n    }];\n\nreturn [msg, msg2];","outputs":2,"noerr":0,"x":520,"y":140,"wires":[["976db23e.1f8ba"],["9ab1a383.0f88b"]]},{"id":"14d4c15d.0b6a7f","type":"switch","z":"9318493b.8ed8b8","name":"Mode","property":"Mode","propertyType":"global","rules":[{"t":"neq","v":"away","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":200,"wires":[["81065b1a.33fb78"]]},{"id":"ebfc5adc.7672f8","type":"switch","z":"8b99f8fe.7b27b8","name":"Mode","property":"Mode","propertyType":"global","rules":[{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":720,"wires":[["55a1471c.7ca3e8"]]},{"id":"98590ccf.4b78b","type":"change","z":"8b99f8fe.7b27b8","name":"","rules":[{"t":"set","p":"Mode","pt":"global","to":"sleep","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":780,"wires":[["27537a62.39b306"]]},{"id":"e6c404a3.fdb278","type":"link in","z":"1c11632f.f206fd","name":"PH: Karina Kontor","links":[],"x":1735,"y":900,"wires":[["d937e7f8.315d88"]]},{"id":"3de649e9.5c9be6","type":"link out","z":"8b99f8fe.7b27b8","name":"to bedroom","links":[],"x":995,"y":740,"wires":[]},{"id":"a085a6f7.ae8698","type":"change","z":"8b99f8fe.7b27b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":740,"wires":[["3de649e9.5c9be6"]]},{"id":"66d9f1c.785941","type":"function","z":"1c11632f.f206fd","name":"Update State_1_floor","func":"let systemState = global.get(\"State_1_floor\") || {};\n\nif(typeof msg.payload === 'object' && msg.payload !== null)\n{\n    for(var k in msg.payload)\n    {\n        \n        let name = msg.payload.devices.name;\n        let power = msg.payload.devices.power ;\n        let pay = { name,power}\n        let id = msg.payload.devices.id;\n        systemState[id] = pay;\n    }\n}\nglobal.set(\"State_1_floor\", systemState);\n\n\nreturn msg;\n\n\n\n\n\n","outputs":1,"noerr":0,"x":720,"y":480,"wires":[["389edf89.60cfe"]]},{"id":"b43d29.a5a572d8","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.power","x":430,"y":560,"wires":[["8979d93a.616b28","66d9f1c.785941"]]},{"id":"6307aa8a.399714","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.power","x":430,"y":500,"wires":[["66d9f1c.785941","7572fcad.03e8d4"]]},{"id":"20506888.a74d58","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.power","x":430,"y":380,"wires":[["23a68d63.954c32","66d9f1c.785941"]]},{"id":"58b40532.eac5ac","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.power","x":430,"y":440,"wires":[["5ac37302.75a94c","66d9f1c.785941"]]},{"id":"317079cf.c65136","type":"json","z":"1c11632f.f206fd","name":"","property":"payload","action":"","pretty":true,"x":310,"y":380,"wires":[["20506888.a74d58"]]},{"id":"a568df99.b3c63","type":"json","z":"1c11632f.f206fd","name":"","property":"payload","action":"","pretty":true,"x":310,"y":440,"wires":[["58b40532.eac5ac"]]},{"id":"adb79c73.b1286","type":"json","z":"1c11632f.f206fd","name":"","property":"payload","action":"","pretty":true,"x":310,"y":500,"wires":[["6307aa8a.399714"]]},{"id":"4957819.8fe9e8","type":"json","z":"1c11632f.f206fd","name":"","property":"payload","action":"","pretty":true,"x":310,"y":560,"wires":[["b43d29.a5a572d8"]]},{"id":"389edf89.60cfe","type":"function","z":"1c11632f.f206fd","name":"Set State_1_floor","func":"let systemState = global.get(\"State_1_floor\") || {};\n\n\n\n    for(var k in systemState)\n    {\n        name = systemState[k].name\n        status = systemState[k].power \n        pay = {jquerySelector: name, status}\n        msg.payload = pay\n        node.send(msg)\n    }\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"x":1030,"y":580,"wires":[["343547fd.e77fb8"]]},{"id":"3573446a.e843bc","type":"deconz-input","z":"605ae98f.8a9998","name":"","server":"12895ae7.9c6bf5","device":"cc:cc:cc:ff:fe:08:18:a1-01-1000","device_name":"TRADFRI open/close remote  : ZHASwitch","topic":"","state":0,"output":"always","outputAtStartup":true,"x":400,"y":200,"wires":[["a4770dbb.04eff"],[]]},{"id":"a4770dbb.04eff","type":"switch","z":"605ae98f.8a9998","name":"button press","property":"payload.buttonevent","propertyType":"msg","rules":[{"t":"eq","v":"2002","vt":"str"},{"t":"eq","v":"1002","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":650,"y":200,"wires":[["4182b18c.6b705"],["20238790.e84df8"]]},{"id":"20238790.e84df8","type":"change","z":"605ae98f.8a9998","name":"Open","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":220,"wires":[["f2a2928e.e1b4f","1bb57f45.872e71","26caebff.0ab3c4"]]},{"id":"4182b18c.6b705","type":"change","z":"605ae98f.8a9998","name":"CLOSE","rules":[{"t":"set","p":"payload","pt":"msg","to":"255","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":180,"wires":[["f2a2928e.e1b4f","1bb57f45.872e71","112531d1.56298e"]]},{"id":"f2a2928e.e1b4f","type":"deconz-output","z":"605ae98f.8a9998","name":"","server":"12895ae7.9c6bf5","device":"cc:cc:cc:ff:fe:02:96:c6-01","device_name":"Window covering device 5 : Window covering device","command":"bri","commandType":"deconz_cmd","payload":"payload","payloadType":"msg","transitionTime":"","x":1280,"y":180,"wires":[]},{"id":"6c1d6758.428808","type":"link in","z":"605ae98f.8a9998","name":"IK: Sov","links":["fd49ca1d.879ac8","b630d8c.cb7f128"],"x":395,"y":160,"wires":[["cec0f8cb.33f1b8"]]},{"id":"cec0f8cb.33f1b8","type":"switch","z":"605ae98f.8a9998","name":"open/close","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":false,"outputs":2,"x":650,"y":160,"wires":[["4182b18c.6b705"],["20238790.e84df8"]]},{"id":"247260f.c82dca","type":"link out","z":"8b99f8fe.7b27b8","name":"SH: HOME","links":["92e6582c.082438","d4984c78.9f697"],"x":2175,"y":320,"wires":[]},{"id":"d6443c6.56eebc","type":"homekit-service","z":"1c11632f.f206fd","isParent":true,"bridge":"83ed609b.13959","parentService":"","name":"IdLock","serviceName":"LockManagement","topic":"","filter":false,"manufacturer":"Default Manufacturer","model":"Default Model","serialNo":"Default Serial Number","cameraConfigVideoProcessor":"ffmpeg","cameraConfigSource":"","cameraConfigStillImageSource":"","cameraConfigMaxStreams":2,"cameraConfigMaxWidth":1280,"cameraConfigMaxHeight":720,"cameraConfigMaxFPS":10,"cameraConfigMaxBitrate":300,"cameraConfigVideoCodec":"libx264","cameraConfigAudioCodec":"libfdk_aac","cameraConfigAudio":false,"cameraConfigPacketSize":1316,"cameraConfigVerticalFlip":false,"cameraConfigHorizontalFlip":false,"cameraConfigMapVideo":"0:0","cameraConfigMapAudio":"0:1","cameraConfigVideoFilter":"scale=1280:720","cameraConfigAdditionalCommandLine":"-tune zerolatency","cameraConfigDebug":false,"cameraConfigSnapshotOutput":"disabled","characteristicProperties":"{}","x":1250,"y":1100,"wires":[[],[]]},{"id":"215f03ef.bed5dc","type":"switch","z":"8b99f8fe.7b27b8","name":"Mode","property":"Mode","propertyType":"global","rules":[{"t":"eq","v":"away","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1390,"y":340,"wires":[["3e0910d1.7d582","f0615fd.9f26ba"]]},{"id":"fc4fe81e.444628","type":"link out","z":"8b99f8fe.7b27b8","name":"SH: Away","links":["d4984c78.9f697"],"x":2055,"y":500,"wires":[]},{"id":"79007779.8a0088","type":"function","z":"1c11632f.f206fd","name":"Update State_basement","func":"let systemState = global.get(\"State_basement\") || {};\n\nif(typeof msg.payload === 'object' && msg.payload !== null)\n{\n    for(var k in msg.payload)\n    {\n        \n        let name = msg.payload.devices.name;\n        let power = msg.payload.devices.power ;\n        let pay = { name,power}\n        let id = msg.payload.devices.id;\n        systemState[id] = pay;\n    }\n}\nglobal.set(\"State_basement\", systemState);\n\nreturn msg;\n\n\n\n\n\n\n","outputs":1,"noerr":0,"x":710,"y":840,"wires":[["3054be45.205a62"]]},{"id":"8a881c9.eeff5e","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.power","x":430,"y":620,"wires":[["79007779.8a0088"]]},{"id":"ad9a81e7.830c3","type":"json","z":"1c11632f.f206fd","name":"","property":"payload","action":"","pretty":true,"x":310,"y":620,"wires":[["8a881c9.eeff5e"]]},{"id":"4b38d41c.e8f9ec","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.power","x":430,"y":660,"wires":[["79007779.8a0088"]]},{"id":"ee3e73ae.3c209","type":"json","z":"1c11632f.f206fd","name":"","property":"payload","action":"","pretty":true,"x":310,"y":660,"wires":[["4b38d41c.e8f9ec"]]},{"id":"37a5cf26.0ece8","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.power","x":430,"y":700,"wires":[["79007779.8a0088"]]},{"id":"b6062edf.85f6f","type":"json","z":"1c11632f.f206fd","name":"","property":"payload","action":"","pretty":true,"x":310,"y":700,"wires":[["37a5cf26.0ece8"]]},{"id":"772ba1ed.98d63","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.power","x":430,"y":740,"wires":[["79007779.8a0088"]]},{"id":"1e1b8bbf.4eac74","type":"json","z":"1c11632f.f206fd","name":"","property":"payload","action":"","pretty":true,"x":310,"y":740,"wires":[["772ba1ed.98d63","a77589e3.9d82e8"]]},{"id":"3054be45.205a62","type":"function","z":"1c11632f.f206fd","name":"Set State_basement","func":"let systemState = global.get(\"State_basement\") || {};\n\n\n\n    for(var k in systemState)\n    {\n        name = systemState[k].name\n        status = systemState[k].power \n        pay = {jquerySelector: name, status}\n        msg.payload = pay\n        node.send(msg)\n    }\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"x":1020,"y":660,"wires":[["db00bb8.82e0148"]]},{"id":"b1e4c558.fb5618","type":"ui_ui_control","z":"1c11632f.f206fd","name":"","events":"all","x":740,"y":580,"wires":[["389edf89.60cfe","3054be45.205a62"]]},{"id":"9702e016.0991d","type":"delay","z":"1c11632f.f206fd","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1860,"y":380,"wires":[["2bfd1c76.96d4a4"]]},{"id":"74a70908.bd50d8","type":"inject","z":"605ae98f.8a9998","name":"Åpne Gardin 07 00","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"55 06 * * 1,2,3,4,5","once":false,"onceDelay":0.1,"x":200,"y":100,"wires":[["8818e486.2765d8"]]},{"id":"8f119d5d.e9645","type":"switch","z":"1c11632f.f206fd","name":"Gardiner","property":"payload.name","propertyType":"msg","rules":[{"t":"eq","v":"Sov_Gardin","vt":"str"}],"checkall":"false","repair":false,"outputs":1,"x":1580,"y":960,"wires":[["e2e0325d.993a1"]]},{"id":"e2e0325d.993a1","type":"change","z":"1c11632f.f206fd","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.on","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1760,"y":960,"wires":[["b630d8c.cb7f128"]]},{"id":"b630d8c.cb7f128","type":"link out","z":"1c11632f.f206fd","name":"Ikea: Gardin SOV","links":["6c1d6758.428808"],"x":1935,"y":960,"wires":[]},{"id":"7f15ef4a.ce4ca","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.power","x":430,"y":800,"wires":[["79007779.8a0088"]]},{"id":"d8a4e608.f39898","type":"link in","z":"1c11632f.f206fd","name":"Sm: Gardin","links":["bb45bf3b.5ab5f"],"x":315,"y":800,"wires":[["7f15ef4a.ce4ca"]]},{"id":"bb45bf3b.5ab5f","type":"link out","z":"605ae98f.8a9998","name":"","links":["d8a4e608.f39898"],"x":1395,"y":220,"wires":[]},{"id":"9ab1a383.0f88b","type":"ui_list","z":"1b14ec1b.20ab54","group":"56a8be2a.9b9eb","name":"Happy","order":4,"width":"6","height":"5","lineType":"three","actionType":"none","allowHTML":false,"outputs":0,"topic":"Happy","x":790,"y":140,"wires":[]},{"id":"70b20e7.a977df","type":"inject","z":"605ae98f.8a9998","name":"0Lukke Gardin 220","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"00 22 * * *","once":false,"onceDelay":0.1,"x":320,"y":60,"wires":[["2603c373.b06f0c"]]},{"id":"9b5b579a.29f748","type":"deconz-input","z":"85114e25.ae2ad","name":"","server":"12895ae7.9c6bf5","device":"ec:1b:bd:ff:fe:3f:85:d8-01-0006","device_name":"TRÅDFRI Motion sensor : ZHAPresence","state":0,"output":"always","outputAtStartup":true,"x":380,"y":140,"wires":[["f1455a76.f34388"],[]]},{"id":"f1455a76.f34388","type":"switch","z":"85114e25.ae2ad","name":"","property":"guestmode","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":true,"outputs":1,"x":610,"y":140,"wires":[["4e31ad0c.3d9d74"]]},{"id":"755efaaf.da6674","type":"function","z":"85114e25.ae2ad","name":"","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":580,"wires":[["ad1069d2.d7fc68","a2a10813.1ed038"]]},{"id":"5cfc1e8d.71f85","type":"inject","z":"1c11632f.f206fd","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":740,"y":620,"wires":[["b1e4c558.fb5618","389edf89.60cfe","3054be45.205a62"]]},{"id":"3a030b43.080134","type":"inject","z":"bc3b2c68.b35f6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":320,"wires":[["9430e52f.746a78"]]},{"id":"4e31ad0c.3d9d74","type":"change","z":"85114e25.ae2ad","name":"","rules":[{"t":"set","p":"payload.devices.presence","pt":"msg","to":"payload.presence","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"trapp","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":140,"wires":[["ca2022fd.f69bc"]]},{"id":"9ff4c6f2.1aa648","type":"switch","z":"85114e25.ae2ad","name":"Lux NivÃ¥","property":"lux","propertyType":"flow","rules":[{"t":"lte","v":"135","vt":"num"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1190,"y":260,"wires":[["7e76be9d.400b7"],[]]},{"id":"59179383.4e18cc","type":"change","z":"85114e25.ae2ad","name":"","rules":[{"t":"set","p":"lux","pt":"flow","to":"payload.devices.illuminance","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"kitcheneye","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":220,"wires":[["ca2022fd.f69bc"]]},{"id":"62ab14e0.1e0c1c","type":"link in","z":"1c11632f.f206fd","name":"update UI","links":[],"x":635,"y":740,"wires":[["b1e4c558.fb5618"]]},{"id":"46c1d472.2e39ac","type":"trigger","z":"8b99f8fe.7b27b8","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1480,"y":520,"wires":[["76623d17.844704","4f6a8027.a60f6","326c7017.9736f"]]},{"id":"b47d65ec.9d46a8","type":"change","z":"8b99f8fe.7b27b8","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1340,"y":460,"wires":[["46c1d472.2e39ac"]]},{"id":"6fce2655.029658","type":"trigger","z":"8b99f8fe.7b27b8","op1":"","op2":"","op1type":"nul","op2type":"date","duration":"5","extend":true,"units":"min","reset":"","bytopic":"all","name":"","x":1610,"y":420,"wires":[["e4c32eed.12537"]]},{"id":"3e0910d1.7d582","type":"change","z":"8b99f8fe.7b27b8","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":380,"wires":[["6fce2655.029658"]]},{"id":"1f708a4e.028846","type":"switch","z":"8b99f8fe.7b27b8","name":"Mode","property":"Mode","propertyType":"global","rules":[{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1390,"y":420,"wires":[["6fce2655.029658"]]},{"id":"e1dcab5a.66f5f8","type":"time-range-switch","z":"8b99f8fe.7b27b8","name":"","lat":"58.851468","lon":"5.748852","startTime":"06:00","endTime":"11:00","startOffset":0,"endOffset":0,"x":330,"y":820,"wires":[["2e0d79f5.69a796"],[]]},{"id":"2e0d79f5.69a796","type":"link out","z":"8b99f8fe.7b27b8","name":"FH: Movement Morning","links":["1d2eacde.d050c3"],"x":575,"y":820,"wires":[]},{"id":"1d2eacde.d050c3","type":"link in","z":"8b99f8fe.7b27b8","name":"FH: Home Mode","links":["2e0d79f5.69a796"],"x":1355,"y":300,"wires":[["3e6914e6.deefec"]]},{"id":"3e6914e6.deefec","type":"switch","z":"8b99f8fe.7b27b8","name":"Mode","property":"Mode","propertyType":"global","rules":[{"t":"eq","v":"away","vt":"str"},{"t":"eq","v":"sleep","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1470,"y":300,"wires":[["f0615fd.9f26ba"],["f0615fd.9f26ba"]]},{"id":"432f9819.985b38","type":"switch","z":"9318493b.8ed8b8","name":"Presence","property":"payload.devices.presence","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":true,"outputs":2,"x":1460,"y":80,"wires":[["6199c3a6.b2c1ec","15f11a5d.7f2bb6","813f45c0.8ed288"],["d97a92f4.627f3","8cb7a4a6.a97738"]]},{"id":"6199c3a6.b2c1ec","type":"function","z":"9318493b.8ed8b8","name":"msg.reset","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":1480,"y":160,"wires":[["8cb7a4a6.a97738"]]},{"id":"ae161303.28f11","type":"switch","z":"9318493b.8ed8b8","name":"Lux NivÃ¥","property":"lux","propertyType":"flow","rules":[{"t":"lte","v":"90","vt":"num"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":910,"y":200,"wires":[["74d16771.1acde8","ab66b8d2.d8bb88"],[]]},{"id":"56c00304.d99d1c","type":"change","z":"9318493b.8ed8b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"power\":\"on\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1880,"y":80,"wires":[["f9c32e8a.e6559"]]},{"id":"d9c60cfe.9c164","type":"inject","z":"9318493b.8ed8b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":750,"y":80,"wires":[["69a2c456.80ad2c"]]},{"id":"525d4b6.a82efb4","type":"nora-blinds","z":"605ae98f.8a9998","devicename":"Blinds","roomhint":"Bedroom","name":"","passthru":false,"invert":false,"nora":"54f6a8ea.957eb8","topic":"rullegardin","x":490,"y":240,"wires":[["d6717b22.f0d1e8"]]},{"id":"26caebff.0ab3c4","type":"function","z":"605ae98f.8a9998","name":"Open","func":"msg.payload = {openPercent : 100};\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":360,"wires":[["525d4b6.a82efb4"]]},{"id":"112531d1.56298e","type":"function","z":"605ae98f.8a9998","name":"Close","func":"msg.payload = {openPercent : 0};\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":320,"wires":[["525d4b6.a82efb4"]]},{"id":"d6717b22.f0d1e8","type":"switch","z":"605ae98f.8a9998","name":"open/close","property":"payload.openPercent","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"100","vt":"str"}],"checkall":"false","repair":true,"outputs":2,"x":650,"y":240,"wires":[["4182b18c.6b705"],["20238790.e84df8"]]},{"id":"1bb57f45.872e71","type":"function","z":"605ae98f.8a9998","name":"","func":"        msg.payload = {devices:{id: \"id\",name: \"Sov_Gardin\", power: (msg.payload === 0) ? \"off\" : \"on\"}};\n      \n        \n   \nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":220,"wires":[["bb45bf3b.5ab5f"]]},{"id":"2603c373.b06f0c","type":"switch","z":"605ae98f.8a9998","name":"","property":"guestmode","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":true,"outputs":1,"x":510,"y":80,"wires":[["cec0f8cb.33f1b8"]]},{"id":"74d16771.1acde8","type":"function","z":"9318493b.8ed8b8","name":"Override ny","func":"var overridebase = global.get('overridebase');\nlet topic = msg.topic || \"nothing\"\n//if(msg.topic !== null){\nif (topic.includes(\"OVERRIDE\"))  {\n    if (msg.payload==\"1\") overridebase=\"ON\";\n    if (msg.payload==\"0\") overridebase=\"OFF\";\n    if (msg.payload==\"A\") overridebase=\"AUTO\";\n//}\n}\nglobal.set('overridebase',overridebase);\n\nnode.status({fill:\"blue\",shape:\"ring\",text:\"Override: \"+ overridebase});    \n\nif (msg.payload==\"A\"){\n   return null; \n} \nif (overridebase==\"ON\"){\n     msg.payload={ \"power\": \"on\"};\n     return [null, msg];\n}\nif (overridebase==\"OFF\") {\n     msg.payload={ \"power\": \"off\"};\n     return [null, msg];\n}\n\nreturn msg;","outputs":2,"noerr":0,"x":1270,"y":200,"wires":[["432f9819.985b38"],["6199c3a6.b2c1ec","f9c32e8a.e6559"]]},{"id":"7e76be9d.400b7","type":"function","z":"85114e25.ae2ad","name":"Override ny","func":"var overrideMain = global.get('overrideMain');\nlet topic = msg.topic || \"nothing\"\n//if(msg.topic !== null){\nif (topic.includes(\"OVERRIDE\"))  {\n    if (msg.payload==\"1\") overrideMain=\"ON\";\n    if (msg.payload==\"0\") overrideMain=\"OFF\";\n    if (msg.payload==\"A\") overrideMain=\"AUTO\";\n//}\n}\nglobal.set('overrideMain',overrideMain);\n\nnode.status({fill:\"blue\",shape:\"ring\",text:\"Override: \"+ overrideMain});    \n\nif (msg.payload==\"A\"){\n\n   return null\n} \nif (overrideMain==\"ON\"){\n     msg.payload={ \"power\": \"on\"};\n     return [null, msg];\n}\nif (overrideMain==\"OFF\") {\n     msg.payload={ \"power\": \"off\"};\n     return [null, msg];\n}\n\nreturn msg;","outputs":2,"noerr":0,"x":1370,"y":280,"wires":[["ff058ca5.d0198"],["dd48ccc.2391c3","a2a10813.1ed038","ad1069d2.d7fc68"]]},{"id":"817f1df1.c5f98","type":"exec","z":"1c11632f.f206fd","command":"node-red-restart","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1520,"y":60,"wires":[[],[],[]]},{"id":"aecb8d48.af66f","type":"inject","z":"1c11632f.f206fd","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1320,"y":60,"wires":[["817f1df1.c5f98"]]},{"id":"ca2022fd.f69bc","type":"function","z":"85114e25.ae2ad","name":"","func":"let status = flow.get(\"status\") || false;\nlet presense = msg.payload.devices.presence;\nif (presense === status){\n    return null;\n}\nflow.set(\"status\", presense) \nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":220,"wires":[["9ff4c6f2.1aa648"]]},{"id":"f8944aeb.38fec8","type":"debug","z":"85114e25.ae2ad","name":"Kitchen eye","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.devices.presence","targetType":"msg","x":770,"y":260,"wires":[]},{"id":"c7d21fe9.5236b","type":"inject","z":"8b99f8fe.7b27b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":1290,"y":240,"wires":[["25a02385.599d9c"]]},{"id":"25a02385.599d9c","type":"change","z":"8b99f8fe.7b27b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":240,"wires":[["f0615fd.9f26ba"]]},{"id":"ff058ca5.d0198","type":"time-range-switch","z":"85114e25.ae2ad","name":"","lat":"58.851468","lon":"5.748852","startTime":"06:00","endTime":"23:00","startOffset":0,"endOffset":0,"x":1530,"y":100,"wires":[["48797fde.8012e","914e585c.b48f18"],[]]},{"id":"868abce4.e6b35","type":"time-range-switch","z":"85114e25.ae2ad","name":"","lat":"58.851468","lon":"5.748852","startTime":"06:00","endTime":"23:00","startOffset":0,"endOffset":0,"x":730,"y":760,"wires":[["990b078.42e04f8"],[]]},{"id":"990b078.42e04f8","type":"switch","z":"85114e25.ae2ad","name":"","property":"guestmode","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":true,"outputs":1,"x":870,"y":760,"wires":[["a2669d7e.88dca"]]},{"id":"8d0c00eb.ae5f4","type":"time-range-switch","z":"85114e25.ae2ad","name":"","lat":"58.851468","lon":"5.748852","startTime":"06:00","endTime":"07:35","startOffset":0,"endOffset":0,"x":1830,"y":660,"wires":[[],["5a1ac503.81491c"]]},{"id":"81065b1a.33fb78","type":"change","z":"9318493b.8ed8b8","name":"","rules":[{"t":"set","p":"lux","pt":"flow","to":"payload.devices.illuminance","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"basement","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":200,"wires":[["ae161303.28f11"]]},{"id":"eef3cfe4.c2546","type":"ui_switch","z":"1c11632f.f206fd","name":"Status","label":"{{label}}","tooltip":"","group":"56a8be2a.9b9eb","order":1,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"home","onvalueType":"str","onicon":"fa-home","oncolor":"Green","offvalue":"away","offvalueType":"str","officon":"fa-sign-out","offcolor":"red","x":1170,"y":1340,"wires":[[]]},{"id":"27c815f.c9ae2ea","type":"function","z":"1c11632f.f206fd","name":"","func":"     msg.label = global.get(\"Mode\");\n     msg.payload = global.get(\"Mode\");\n \nreturn msg;\n","outputs":1,"noerr":0,"x":910,"y":1340,"wires":[["eef3cfe4.c2546"]]},{"id":"d4984c78.9f697","type":"link in","z":"1c11632f.f206fd","name":"","links":["247260f.c82dca","fc4fe81e.444628"],"x":555,"y":1340,"wires":[["37fa2d63.d81d82"]]},{"id":"772b0560.6b8bcc","type":"link out","z":"8b99f8fe.7b27b8","name":"heggland","links":["63c7ba61.3e3df4"],"x":695,"y":520,"wires":[]},{"id":"47763aff.5ff334","type":"link out","z":"8b99f8fe.7b27b8","name":"karina","links":["b9ab5a15.2f2aa8"],"x":695,"y":560,"wires":[]},{"id":"91c6cb92.d3bcf8","type":"ui_switch","z":"1c11632f.f206fd","name":"heggland","label":"{{label}}","tooltip":"","group":"56a8be2a.9b9eb","order":1,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"fa-home","oncolor":"Green","offvalue":"false","offvalueType":"bool","officon":"fa-sign-out","offcolor":"red","x":1260,"y":1380,"wires":[[]]},{"id":"4c47553.701abac","type":"function","z":"1c11632f.f206fd","name":"","func":"var d = new Date();\nvar n = d.toLocaleTimeString();\n\nmsg.label = \"Øivind\"\n\nlet msg2 = {label: \"Øivind:  \" +   n, payload: msg.payload};\n\nreturn [msg2,msg];\n","outputs":2,"noerr":0,"x":910,"y":1380,"wires":[["91c6cb92.d3bcf8"],["3220b5b9.05cd2a"]]},{"id":"d54fc480.c511b8","type":"ui_switch","z":"1c11632f.f206fd","name":"karina","label":"{{label}}","tooltip":"","group":"56a8be2a.9b9eb","order":1,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"fa-home","oncolor":"Green","offvalue":"false","offvalueType":"bool","officon":"fa-sign-out","offcolor":"red","x":1250,"y":1420,"wires":[[]]},{"id":"ec9bf67a.33c2b8","type":"function","z":"1c11632f.f206fd","name":"","func":"var d = new Date();\nvar n = d.toLocaleTimeString();\n\nmsg.label = \"Karina\"\n\nlet msg2 = {label: \"Karina:  \" +   n, payload: msg.payload};\n\nreturn [msg2,msg];\n","outputs":2,"noerr":0,"x":910,"y":1420,"wires":[["d54fc480.c511b8"],["3220b5b9.05cd2a"]]},{"id":"63c7ba61.3e3df4","type":"link in","z":"1c11632f.f206fd","name":"","links":["772b0560.6b8bcc"],"x":715,"y":1380,"wires":[["4c47553.701abac"]]},{"id":"b9ab5a15.2f2aa8","type":"link in","z":"1c11632f.f206fd","name":"","links":["47763aff.5ff334"],"x":715,"y":1420,"wires":[["ec9bf67a.33c2b8"]]},{"id":"6cce33bd.bbcbcc","type":"switch","z":"8b99f8fe.7b27b8","name":"","property":"guestmode","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":true,"outputs":1,"x":1270,"y":340,"wires":[["215f03ef.bed5dc"]]},{"id":"710e043d.1a1ddc","type":"switch","z":"8b99f8fe.7b27b8","name":"","property":"guestmode","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":true,"outputs":1,"x":1250,"y":420,"wires":[["1f708a4e.028846"]]},{"id":"8a2b5b04.944b38","type":"change","z":"1c11632f.f206fd","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":620,"wires":[["3054be45.205a62","389edf89.60cfe"]]},{"id":"2bd701cc.7095be","type":"debug","z":"8b99f8fe.7b27b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1200,"y":400,"wires":[]},{"id":"16e01a0.bfa88e6","type":"trigger","z":"8b99f8fe.7b27b8","op1":"home","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"away","bytopic":"all","name":"","x":960,"y":340,"wires":[["6cce33bd.bbcbcc","fc71e441.058a48","2bd701cc.7095be"]]},{"id":"fc71e441.058a48","type":"trigger","z":"8b99f8fe.7b27b8","op1":"away","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"home","bytopic":"all","name":"","x":960,"y":420,"wires":[["710e043d.1a1ddc","b47d65ec.9d46a8","16e01a0.bfa88e6","2bd701cc.7095be"]]},{"id":"2eb3844e.0fee8c","type":"change","z":"8b99f8fe.7b27b8","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":240,"wires":[["16e01a0.bfa88e6","fc71e441.058a48"]]},{"id":"df044127.2306a","type":"inject","z":"8b99f8fe.7b27b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":260,"wires":[["2eb3844e.0fee8c"]]},{"id":"37fa2d63.d81d82","type":"change","z":"1c11632f.f206fd","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":1340,"wires":[["27c815f.c9ae2ea"]]},{"id":"29e9dacc.e78cd6","type":"inject","z":"8b99f8fe.7b27b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320,"y":480,"wires":[["394f6d15.3c43e2"]]},{"id":"3f2ad883.c0a158","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":640,"wires":[["87ef4cd9.24919"]]},{"id":"aa0b6d5d.1543d","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":680,"wires":[["b7aa8b08.2d6208"]]},{"id":"fa7fd71b.8663d8","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":720,"wires":[["7ebcbc9e.7409d4"]]},{"id":"49262ade.9116a4","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":760,"wires":[["d6c2e23f.d29f8"]]},{"id":"eb7e9e84.10e46","type":"rbe","z":"1c11632f.f206fd","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1830,"y":840,"wires":[["fc79aea8.12ce5"]]},{"id":"9e81b57.dcd0948","type":"complete","z":"1c11632f.f206fd","name":"","scope":[],"uncaught":false,"x":360,"y":200,"wires":[[]]},{"id":"b46f1732.77cab8","type":"site","z":"8b99f8fe.7b27b8","user":"3fb4f73e.f3cd38","name":"Hegglunds","x":100,"y":100,"wires":[["c6a1a448.8f01b8"]]},{"id":"c6a1a448.8f01b8","type":"json","z":"8b99f8fe.7b27b8","name":"","property":"payload","action":"","pretty":false,"x":230,"y":100,"wires":[["371d9d37.31cca2","e440dcf5.bc9da"]]},{"id":"1efbf8d9.4be9e7","type":"change","z":"8b99f8fe.7b27b8","name":"","rules":[{"t":"set","p":"Mode","pt":"global","to":"payload.site.mode","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":100,"wires":[["2161a91.ef9e256","973fda0d.893748"]]},{"id":"f9af4243.f136b","type":"switch","z":"8b99f8fe.7b27b8","name":"","property":"Mode","propertyType":"global","rules":[{"t":"eq","v":"sleep","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":100,"wires":[["1efbf8d9.4be9e7"],["1efbf8d9.4be9e7"]]},{"id":"1fa81cab.ee0ad3","type":"rbe","z":"8b99f8fe.7b27b8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.site.mode","x":470,"y":100,"wires":[["f9af4243.f136b"]]},{"id":"371d9d37.31cca2","type":"function","z":"8b99f8fe.7b27b8","name":"","func":"\n\nif(typeof  msg.payload.site !== \"undefined\")\n{\n    var Mode = msg.payload.site.mode\n return msg; \n} \n  \nif(typeof  msg.payload.devices[0].functionality !== \"undefined\")\n{\n \n    if (msg.payload.devices[0].functionality == \"lighting\") {\n        var Light = {};\n        Light.name = msg.payload.devices[0].name;\n        Light.power = msg.payload.devices[0].power;\n        Light.Room = msg.payload.devices[0].room;\n        Light.id = msg.payload.devices[0].id;\n       return [null,Light];  \n    }\n \n} \n","outputs":2,"noerr":0,"x":350,"y":100,"wires":[["1fa81cab.ee0ad3"],["b0c298c0.280d08","df062930.33e9a8"]]},{"id":"2161a91.ef9e256","type":"switch","z":"8b99f8fe.7b27b8","name":"","property":"Mode","propertyType":"global","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"away","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":160,"wires":[["16e01a0.bfa88e6"],["fc71e441.058a48"]]},{"id":"4c6b976d.5fb918","type":"inject","z":"f487aa99.386108","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":160,"wires":[["602fce3c.7d792"]]},{"id":"602fce3c.7d792","type":"influxdb in","z":"f487aa99.386108","influxdb":"99977a8c.c02588","name":"Get Motion ","query":"select * from Motion ORDER BY time DESC limit 10 ","rawOutput":false,"precision":"","retentionPolicy":"","x":670,"y":160,"wires":[["4c3aea37.34b724"]]},{"id":"991ef94.bba8508","type":"ui_list","z":"f487aa99.386108","group":"583fffe9.e7d8f","name":"Movement","order":1,"width":"7","height":15,"lineType":"three","actionType":"none","allowHTML":false,"outputs":0,"topic":"Movement","x":1050,"y":160,"wires":[]},{"id":"f75f85a7.382cd8","type":"function","z":"fbdfe0f1.47d8","name":"Iterate","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    \n    var listdata = {};\n    listdata.title = msg.payload.name;\n    listdata.description = \"Bevegelse: \" +  msg.payload.movement + \"   time:  \" + msg.payload.time ;\n    itt.outArray.push(listdata)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":347,"y":220,"wires":[[],[]]},{"id":"8f9dc82d.0e7b28","type":"trigger","z":"f487aa99.386108","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":850,"y":120,"wires":[["4c3aea37.34b724"]]},{"id":"fc896ae2.2631d8","type":"function","z":"f487aa99.386108","name":"Iterate","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    \n    var listdata = {};\n     listdata.title = msg.payload.mode\n    listdata.icon_name = \"fa-home\";\n    if(listdata.title == \"away\"){\n         listdata.icon_name = \"fa-sign-out\";\n    }else if (listdata.title == \"sleep\"){\n         listdata.icon_name = \"fa-bed\";\n    }\n    \n    listdata.title = msg.payload.mode + \": \" + msg.payload.time.toLocaleTimeString();\n    listdata.description = msg.payload.time.toDateString()  ;\n    itt.outArray.push(listdata)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":850,"y":280,"wires":[["9525b6d6.0d24b8"],["3f602c1d.afdeb4"]]},{"id":"cac92042.f5d51","type":"inject","z":"f487aa99.386108","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":280,"wires":[["fbde8b9b.41d5c8"]]},{"id":"fbde8b9b.41d5c8","type":"influxdb in","z":"f487aa99.386108","influxdb":"99977a8c.c02588","name":"Get Mode","query":"select * from Mode ORDER BY time DESC limit 10 ","rawOutput":false,"precision":"","retentionPolicy":"","x":660,"y":280,"wires":[["fc896ae2.2631d8"]]},{"id":"3f602c1d.afdeb4","type":"ui_list","z":"f487aa99.386108","group":"583fffe9.e7d8f","name":"Mode","order":2,"width":"7","height":15,"lineType":"three","actionType":"none","allowHTML":false,"outputs":0,"topic":"Mode","x":1010,"y":280,"wires":[]},{"id":"9525b6d6.0d24b8","type":"trigger","z":"f487aa99.386108","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":850,"y":240,"wires":[["fc896ae2.2631d8"]]},{"id":"4c3aea37.34b724","type":"function","z":"f487aa99.386108","name":"Iterate","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    \n    var listdata = {};\n     listdata.title = msg.payload.name + \": \" + msg.payload.time.toLocaleTimeString();\n    listdata.icon_name =  \"fa-stop\";\n    if(msg.payload.movement === true){\n           listdata.icon_name = \"fa-play\";\n    }\n    \n    \n    listdata.description =  msg.payload.time.toDateString()  ;\n    itt.outArray.push(listdata)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":849,"y":163,"wires":[["8f9dc82d.0e7b28"],["991ef94.bba8508"]]},{"id":"a2669d7e.88dca","type":"trigger","z":"85114e25.ae2ad","op1":"{\"power\":\"on\"}","op2":"{\"power\":\"off\"}","op1type":"json","op2type":"json","duration":"5","extend":true,"units":"min","reset":"","bytopic":"all","name":"","x":1090,"y":720,"wires":[["4a9df2a6.db9e6c"]]},{"id":"9d5a29ac.ba5878","type":"rbe","z":"8b99f8fe.7b27b8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":570,"y":520,"wires":[["772b0560.6b8bcc"]]},{"id":"7f16d91b.b91a58","type":"rbe","z":"8b99f8fe.7b27b8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":570,"y":560,"wires":[["47763aff.5ff334"]]},{"id":"3d1162d0.861b9e","type":"function","z":"f487aa99.386108","name":"Iterate","func":"//Node has 2 outputs - 1 for itteration and 1 for completion\nvar nextObj, out;\nvar itt = msg.iterationInfo;\n\n\n//If the iterating has not yet begun set up the iteration metadata in the msg\nif (typeof itt === 'undefined') {\n    //Make sure payload is an array\n    if( Object.prototype.toString.call(msg.payload) !== '[object Array]' ) {\n       msg.payload = [msg.payload];\n    }\n\n    msg.iterationInfo = itt = {};\n    itt.index = -1;\n    itt.inArray = msg.payload;\n    itt.outArray = [];\n\n//Otherwise just push the input to the output array\n} else {\n    \n    var listdata = {};\n     listdata.title = msg.payload.name\n    listdata.icon_name = \"fa-home\";\n    if(msg.payload.Status === false){\n         listdata.icon_name = \"fa-sign-out\";\n    }\n    \n    listdata.title = msg.payload.name + \": \" + msg.payload.Status;\n    listdata.description = \"KL:  \" + msg.payload.time.toLocaleTimeString() + \" \" + msg.payload.time.toDateString()  ;\n    itt.outArray.push(listdata)\n}\n\n//Goto next object\nitt.index ++;\n\n//If there are stil objects left to iterate goto the next one in the original array\nif (itt.index < itt.inArray.length) {\n    nextObj = msg;\n    msg.payload = itt.inArray[itt.index];\n\n//otherwise pass the out array as the payload\n} else {\n    out = msg;\n    msg.payload = itt.outArray;\n    delete msg.iterationInfo;\n}\n\nreturn [nextObj, out];","outputs":"2","noerr":0,"x":850,"y":380,"wires":[["13992971.9f5ad7"],["7867cbfa.2c5394"]]},{"id":"57121958.385898","type":"inject","z":"f487aa99.386108","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":380,"wires":[["d3a7cd73.75602"]]},{"id":"d3a7cd73.75602","type":"influxdb in","z":"f487aa99.386108","influxdb":"99977a8c.c02588","name":"Get UserState","query":"select * from UserState ORDER BY time DESC limit 10 ","rawOutput":false,"precision":"","retentionPolicy":"","x":680,"y":380,"wires":[["3d1162d0.861b9e"]]},{"id":"7867cbfa.2c5394","type":"ui_list","z":"f487aa99.386108","group":"583fffe9.e7d8f","name":"userState","order":2,"width":"7","height":15,"lineType":"three","actionType":"none","allowHTML":false,"outputs":0,"topic":"Mode","x":1020,"y":380,"wires":[]},{"id":"13992971.9f5ad7","type":"trigger","z":"f487aa99.386108","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"10","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":850,"y":340,"wires":[["3d1162d0.861b9e"]]},{"id":"bc0ef153.a88eb","type":"inject","z":"1c11632f.f206fd","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":430,"y":1420,"wires":[["4c47553.701abac","ec9bf67a.33c2b8"]]},{"id":"1f582a21.663076","type":"ui_ui_control","z":"f487aa99.386108","name":"","events":"connect","x":240,"y":260,"wires":[["602fce3c.7d792","fbde8b9b.41d5c8","d3a7cd73.75602"]]},{"id":"a2a10813.1ed038","type":"function","z":"85114e25.ae2ad","name":"msg.reset","func":"msg.reset = true;\nreturn msg;","outputs":1,"noerr":0,"x":2000,"y":400,"wires":[["38c7d145.d78a6e"]]},{"id":"8818e486.2765d8","type":"switch","z":"605ae98f.8a9998","name":"","property":"sleepLonger","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":100,"wires":[["2603c373.b06f0c"]]},{"id":"57af7185.ee32f","type":"change","z":"1c11632f.f206fd","name":"","rules":[{"t":"set","p":"sleepLonger","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1320,"y":1000,"wires":[[]]},{"id":"4b175a54.957e04","type":"ui_switch","z":"1c11632f.f206fd","name":"SleepLonger","label":"SleepLonger","tooltip":"","group":"56a8be2a.9b9eb","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1090,"y":1020,"wires":[["3c3caacd.eb8986","57af7185.ee32f"]]},{"id":"3c3caacd.eb8986","type":"trigger","z":"1c11632f.f206fd","op1":"","op2":"false","op1type":"nul","op2type":"bool","duration":"15","extend":false,"units":"hr","reset":"false","bytopic":"all","name":"","x":1090,"y":980,"wires":[["4b175a54.957e04"]]},{"id":"38c7d145.d78a6e","type":"trigger","z":"85114e25.ae2ad","op1":"true","op2":"0","op1type":"bool","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":1860,"y":140,"wires":[["f6618be.290b278"]]},{"id":"cc9e00d3.300e7","type":"link in","z":"85114e25.ae2ad","name":"Reset Ligt On","links":["4f4fd26d.04d17c","8979d93a.616b28"],"x":1600,"y":260,"wires":[["a2a10813.1ed038"]]},{"id":"7572fcad.03e8d4","type":"switch","z":"1c11632f.f206fd","name":"","property":"payload.devices.power","propertyType":"msg","rules":[{"t":"cont","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":400,"wires":[["4f4fd26d.04d17c","8979d93a.616b28"]]},{"id":"503fbd81.ce1844","type":"inject","z":"85114e25.ae2ad","name":"","topic":"","payload":"{\"devices\":{\"presence\":true}}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1290,"y":140,"wires":[["ff058ca5.d0198"]]},{"id":"a77589e3.9d82e8","type":"debug","z":"1c11632f.f206fd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":980,"y":400,"wires":[]},{"id":"44c2e3cf.acb54c","type":"inject","z":"85114e25.ae2ad","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2360,"y":180,"wires":[["e7bf0841.4cc108"]]},{"id":"b0c298c0.280d08","type":"debug","z":"8b99f8fe.7b27b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":160,"wires":[]},{"id":"e440dcf5.bc9da","type":"debug","z":"8b99f8fe.7b27b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":270,"y":180,"wires":[]},{"id":"df062930.33e9a8","type":"link out","z":"8b99f8fe.7b27b8","name":"Light Out","links":["c6fffdab.bb8aa"],"x":640,"y":160,"wires":[]},{"id":"c6fffdab.bb8aa","type":"link in","z":"1c11632f.f206fd","name":"","links":["df062930.33e9a8"],"x":200,"y":880,"wires":[["5692aa.4a693d58"]]},{"id":"5692aa.4a693d58","type":"switch","z":"1c11632f.f206fd","name":"Up/Down - Stairs","property":"Room","propertyType":"msg","rules":[{"t":"eq","v":"9","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":380,"y":880,"wires":[["79007779.8a0088","6b97a19d.4f98c"]]},{"id":"6b97a19d.4f98c","type":"debug","z":"1c11632f.f206fd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":590,"y":940,"wires":[]},{"id":"aff3290a.283108","type":"function","z":"1c11632f.f206fd","name":"Update State_basement","func":"let systemState = global.get(\"State_basement\") || {};\n\nif(typeof msg.payload === 'object' && msg.payload !== null)\n{\n    for(var k in msg.payload)\n    {\n        \n        let name = msg.payload.name;\n        let power = msg.payload.power ;\n        let pay = { name,power}\n        let id = msg.payload.id;\n        systemState[id] = pay;\n    }\n}\nglobal.set(\"State_basement\", systemState);\n\nreturn msg;\n\n\n\n\n\n\n","outputs":1,"noerr":0,"x":710,"y":880,"wires":[["3054be45.205a62"]]},{"id":"26ee5240.91657e","type":"debug","z":"1c11632f.f206fd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1540,"y":600,"wires":[]},{"id":"6c54c6c8.7ee968","type":"debug","z":"85114e25.ae2ad","name":"Kitchen eye ILLUMENANCE","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.devices.illuminance","targetType":"msg","x":640,"y":300,"wires":[]},{"id":"ab66b8d2.d8bb88","type":"rbe","z":"9318493b.8ed8b8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.presence","x":1070,"y":260,"wires":[["b6bc1feb.434cf"]]},{"id":"64201c92.37f894","type":"link out","z":"85114e25.ae2ad","name":"DataOut","links":["93ef5d70.0130e"],"x":1755,"y":60,"wires":[]},{"id":"914e585c.b48f18","type":"rbe","z":"85114e25.ae2ad","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload.devices.presence","x":1650,"y":40,"wires":[["64201c92.37f894"]]},{"id":"77ccbb67.9f0614","type":"influxdb out","z":"f487aa99.386108","influxdb":"99977a8c.c02588","name":"Motion","measurement":"Motion","precision":"","retentionPolicy":"","x":850,"y":620,"wires":[]},{"id":"6c66c8c9.ee9c18","type":"function","z":"f487aa99.386108","name":"Store Movement","func":"var d = new Date();\nvar n = d.getTime();\n\nmsg.payload = {\n    name:msg.topic,\n    movement: msg.payload.devices.presence\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":680,"y":620,"wires":[["77ccbb67.9f0614"]]},{"id":"93ef5d70.0130e","type":"link in","z":"f487aa99.386108","name":"Movement Status","links":["64201c92.37f894","b6bc1feb.434cf"],"x":515,"y":620,"wires":[["6c66c8c9.ee9c18"]]},{"id":"b6bc1feb.434cf","type":"link out","z":"9318493b.8ed8b8","name":"Data Out","links":["93ef5d70.0130e"],"x":1175,"y":260,"wires":[]},{"id":"973fda0d.893748","type":"link out","z":"8b99f8fe.7b27b8","name":"Mode Out","links":["5b63eaae.4cbcf4"],"x":995,"y":100,"wires":[]},{"id":"fdbcb7b8.ece208","type":"function","z":"f487aa99.386108","name":"Store Mode","func":"var d = new Date();\nvar n = d.getTime();\n\nmsg.payload = {\n    mode:global.get(\"Mode\")\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":660,"wires":[["5da10e65.4ab27"]]},{"id":"5da10e65.4ab27","type":"influxdb out","z":"f487aa99.386108","influxdb":"99977a8c.c02588","name":"Mode","measurement":"Mode","precision":"","retentionPolicy":"","x":850,"y":660,"wires":[]},{"id":"5b63eaae.4cbcf4","type":"link in","z":"f487aa99.386108","name":"Mode Status","links":["973fda0d.893748"],"x":515,"y":660,"wires":[["fdbcb7b8.ece208"]]},{"id":"3220b5b9.05cd2a","type":"link out","z":"1c11632f.f206fd","name":"Person Out","links":["e3ae9576.18be48"],"x":1140,"y":1520,"wires":[]},{"id":"e665b73a.350dd8","type":"influxdb out","z":"f487aa99.386108","influxdb":"99977a8c.c02588","name":"Users","measurement":"UserState","precision":"","retentionPolicy":"","x":850,"y":700,"wires":[]},{"id":"1ad64b95.49d574","type":"function","z":"f487aa99.386108","name":"Store Person","func":"var d = new Date();\nvar n = d.getTime();\n\nmsg.payload = {\n    name:msg.label,\n    Status: msg.payload\n    \n}\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":700,"wires":[["e665b73a.350dd8"]]},{"id":"e3ae9576.18be48","type":"link in","z":"f487aa99.386108","name":"Person Status","links":["3220b5b9.05cd2a"],"x":515,"y":700,"wires":[["1ad64b95.49d574"]]}]